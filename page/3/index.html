<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Anyuan&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="Anyuan's blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Anyuan's blog">
<meta property="og:description" content="记录点滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Anyuan's blog">
<meta name="twitter:description" content="记录点滴">
  
    <link rel="alternative" href="/atom.xml" title="Anyuan&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anyuan&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">home</a>
        
          <a class="main-nav-link" href="/archives">archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-UIApplicationDelegate-启动选项介绍" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/05/UIApplicationDelegate-启动选项介绍/" class="article-date">
  <time datetime="2014-03-05T08:19:36.000Z" itemprop="datePublished">2014-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/05/UIApplicationDelegate-启动选项介绍/">UIApplicationDelegate 启动选项介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&#10;&#123;&#10;  // Override point for customization after application launch.&#10;  return YES;&#10;&#125;&#10;&#10;- (void)applicationWillResignActive:(UIApplication *)application&#10;&#123;&#10;  // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.&#10;  // Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.&#10;&#125;&#10;&#10;- (void)applicationDidEnterBackground:(UIApplication *)application&#10;&#123;&#10;  // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.&#10;  // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.&#10;&#125;&#10;&#10;- (void)applicationWillEnterForeground:(UIApplication *)application&#10;&#123;&#10;  // Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.&#10;&#125;&#10;&#10;- (void)applicationDidBecomeActive:(UIApplication *)application&#10;&#123;&#10;  // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.&#10;&#125;&#10;&#10;- (void)applicationWillTerminate:(UIApplication *)application&#10;&#123;&#10;  // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>每个iOS app的入口都是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br></pre></td></tr></table></figure>
<p>当app启动完成，准备运行时，application会调用自己的这个代理方法。</p>
<p>一个app除了点击图标进行启动，还有一些其他方式调用一个app。区别不同启动方式，就需要用到launchOptions. 与userInfo 字典相似，<code>-application:didFinishLaunchingWithOptions:</code> 可以通过launchOptions获取启动信息的key。</p>
<p><strong>通过URL启动</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@&#34;app://...&#34;]];</span><br></pre></td></tr></table></figure>
<p><a href="http://URL" target="_blank" rel="external">http://URL</a> 会调用Safari， mailto://URL 会打开邮箱， tel://URL 会拨打电话。</p>
<p>这种情况下<code>launchOptions</code> 为<code>UIApplicationLaunchOptionsURLKey</code></p>
<p>app通过URL调用时，还可以有一些系统信息。 当通过<code>UIDocumentInteractionController</code> 或者 AirDrop 调用时，<code>launchedOptions</code> 会被设置为：</p>
<p><code>UIApplicationLaunchOptionsSourceApplicationKey:</code> key值是一个NSString，表示要调用你app的app bundle ID</p>
<p><code>UIApplicationLaunchOptionsAnnotationKey:</code> key可以存储property-list 对象。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSURL *fileURL = [[NSBundle mainBundle] URLForResource:@&#34;Document&#34; withExtension:@&#34;pdf&#34;];&#10;if (fileURL) &#123;&#10;  UIDocumentInteractionController *documentInteractionController =&#10;  [UIDocumentInteractionController interactionControllerWithURL:fileURL];&#10;&#10;  documentInteractionController.annotation = @&#123;@&#34;foo&#34;: @&#34;bar&#34;&#125;;&#10;  [documentInteractionController setDelegate:self];&#10;  [documentInteractionController presentPreviewAnimated:YES];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>推送消息调用</strong></p>
<p><strong>远程推送</strong></p>
<p>远程推送消息调用时，launch option 会是 <code>UIApplicationLaunchOptionsRemoteNotificationKey</code>，</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)applicationdidFinishLaunchingWithOptions:(NSDictionary *)launchOptions&#10;&#123;&#10;  // ...&#10;&#10;    if (launchOptions[UIApplicationLaunchOptionsRemoteNotificationKey]) &#123;&#10;       [self application:application didReceiveRemoteNotification:launchOptions[UIApplicationLaunchOptionsRemoteNotificationKey]];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>本地推送</strong></p>
<p>本地推送launch options 会是 <code>UIApplicationLaunchOptionsLocalNotificationKey</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import AVFoundation;&#10;@interface AppDelegate ()&#10;@property (readwrite, nonatomic, assign) SystemSoundID localNotificationSound;&#10;@end&#10;&#10;- (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification&#10;&#123;     &#10;    if (application.applicationState == UIApplicationStateActive) &#123;         &#10;   UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:notification.alertAction                                                               message:notification.alertBody                                                                 delegate:nil&#10;                                             cancelButtonTitle:NSLocalizedString(@&#34;OK&#34;, nil)                                                otherButtonTitles:nil];         &#10;   if (!self.localNotificationSound) &#123;             &#10;        NSURL *soundURL = [[NSBundle mainBundle] URLForResource:@&#34;Sosumi&#34;                                                                        withExtension:@&#34;wav&#34;];             &#10;     AudioServicesCreateSystemSoundID((__bridge CFURLRef)soundURL, &#38;_localNotificationSound);      &#125;         &#10;    AudioServicesPlaySystemSound(self.localNotificationSound);         &#10;    [alertView show];     &#10;  &#125;&#10;&#125;&#10;- (void)applicationWillTerminate:(UIApplication *)application &#123;     &#10;  if (self.localNotificationSound) &#123;         &#10;      AudioServicesDisposeSystemSoundID(self.localNotificationSound);     &#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>位置事件调用</strong></p>
<p>当由手机位置变动，调用app时，launch option 会是 <code>UIApplicationLaunchOptionsLocationKey</code>, key 是一个NSNumber 包含一个Boolean。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import CoreLocation;&#10;@interface AppDelegate () &#60;CLLocationManagerDelegate&#62;&#10;@property (readwrite, nonatomic, strong) CLLocationManager *locationManager;&#10;@end&#10;&#10;- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;     &#10;  // ...     &#10;  if (![CLLocationManager locationServicesEnabled]) &#123;         &#10;  [[[UIAlertView alloc] initWithTitle:NSLocalizedString(@&#34;Location Services Disabled&#34;, nil)                                  message:NSLocalizedString(@&#34;You currently have all location services for this device disabled. If you proceed, you will be asked to confirm whether location services should be reenabled.&#34;, nil)                                    &#10;                             delegate:nil                           &#10;                    cancelButtonTitle:NSLocalizedString(@&#34;OK&#34;, nil)                                                otherButtonTitles:nil] show];     &#10;   &#125;&#10;   else &#123;         &#10;       self.locationManager = [[CLLocationManager alloc] init];         &#10;       self.locationManager.delegate = self;         &#10;       [self.locationManager startMonitoringSignificantLocationChanges];     &#10;   &#125;     &#10;   if (launchOptions[UIApplicationLaunchOptionsLocationKey]) &#123;         &#10;   [self.locationManager startUpdatingLocation];     &#10;   &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Newsstand</strong></p>
<p>launch option 会是 <code>UIApplicationLaunchOptionsNewsstandDownloadsKey</code>, 提示用户有新的Newsstand可以下载</p>
<p>蓝牙调用</p>
<p>iOS 7 中蓝牙分主从关系，所以对应的launch option key有两种</p>
<p><code>UIApplicationLaunchOptionsBluetoothCentralsKey</code></p>
<p><code>UIApplicationLaunchOptionsBluetoothPeripheralsKey</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;@import CoreBluetooth;&#10;@interface AppDelegate () &#60;CBCentralManagerDelegate&#62;&#10;@property (readwrite, nonatomic, strong) CBCentralManager *centralManager;&#10;@end&#10;&#10;self.centralManager = [[CBCentralManager alloc] initWithDelegate:self&#10;                                                         queue:nil&#10;                                                         options:@&#123;CBCentralManagerOptionRestoreIdentifierKey:(launchOptions[UIApplicationLaunchOptionsBluetoothCentralsKey] ?: [[NSUUID UUID] UUIDString])&#125;];&#10;if (self.centralManager.state == CBCentralManagerStatePoweredOn) &#123;     &#10;  static NSString * const UID = @&#34;7C13BAA0-A5D4-4624-9397-15BF67161B1C&#34;; // generated with `$ uuidgen`     &#10;  NSArray *services = @[[CBUUID UUIDWithString:UID]];     &#10;  NSDictionary *scanOptions = @&#123;CBCentralManagerScanOptionAllowDuplicatesKey:@YES&#125;;     &#10;  [self.centralManager scanForPeripheralsWithServices:services options:scanOptions];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://nshipster.com/launch-options/" target="_blank" rel="external">参考链接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/03/05/UIApplicationDelegate-启动选项介绍/" data-id="cl4kp32yh001tvjz6sz9a1y3c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS7-nested-push-animation-can-result-in-corrupted" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/19/iOS7-nested-push-animation-can-result-in-corrupted/" class="article-date">
  <time datetime="2014-02-19T06:17:53.000Z" itemprop="datePublished">2014-02-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/02/19/iOS7-nested-push-animation-can-result-in-corrupted/">iOS7 nested push animation can result in corrupted</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在iOS7中，开启push/pop view controller 动画遇到一个问题，就是在快速切换多次后会在console出现一个问题</p>
<pre><code>nested push animation can <span class="literal">result</span> <span class="keyword">in</span> corrupted navigation bar multiple warning
<span class="type">Unbalanced</span> calls to begin/<span class="keyword">end</span> appearance transitions <span class="keyword">for</span>
</code></pre><p>查了一些资料后，找到了一个方法：</p>
<p>0）找到push/pop view controller 动画结束的回调。</p>
<p>UINavigationControllerDelegate代理中的</p>
<pre><code><span class="pp">-<span class="params">(void)</span>navigationController:<span class="params">(<span class="variable">UINavigationController</span> *)</span>navigationController
  didShowViewController:<span class="params">(<span class="variable">UIViewController</span> *)</span>viewController
               animated:<span class="params">(<span class="variable">BOOL</span>)</span>animated</span>
</code></pre><p>1）找到是否接受点击方法的方法。</p>
<p>UIGestureRecognizerDelegate中的</p>
<pre><code><span class="pp">-<span class="params">(<span class="variable">BOOL</span>)</span>gestureRecognizer:<span class="params">(<span class="variable">UIGestureRecognizer</span> *)</span>gestureRecognizer shouldReceiveTouch:<span class="params">(<span class="variable">UITouch</span> *)</span>touch</span>
</code></pre><p>应用以上两个代理方法，加上一个BOOL的flag值，可以控制是否处罚pop/push</p>
<p>当动画完成时，将flag设置为允许pop/push， <code>shouldReceiveTouch</code>直接返回flag值。</p>
<p>在点击事件时，要注意更改flag值不再接受其他事件，防止在flag为YES时的多次点击。</p>
<p>参考链接：</p>
<p><a href="http://stackoverflow.com/questions/11813091/nested-push-animation-can-result-in-corrupted-navigation-bar-multiple-warning" target="_blank" rel="external">http://stackoverflow.com/questions/11813091/nested-push-animation-can-result-in-corrupted-navigation-bar-multiple-warning</a></p>
<p><a href="http://www.taofengping.com/2013/12/26/ios7_barbuttonitem_navigation_gesture/" target="_blank" rel="external">http://www.taofengping.com/2013/12/26/ios7_barbuttonitem_navigation_gesture/</a></p>
<p><a href="http://blog.csdn.net/lengshengren/article/details/12616217" target="_blank" rel="external">http://blog.csdn.net/lengshengren/article/details/12616217</a></p>
<p><a href="http://stackoverflow.com/questions/10150231/how-to-detect-when-uinavigationcontroller-animation-has-finished" target="_blank" rel="external">http://stackoverflow.com/questions/10150231/how-to-detect-when-uinavigationcontroller-animation-has-finished</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/02/19/iOS7-nested-push-animation-can-result-in-corrupted/" data-id="cl4kp32xw000qvjz6l9yfnduz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-消息传递过程解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/12/08/iOS-消息传递过程解析/" class="article-date">
  <time datetime="2013-12-08T12:15:30.000Z" itemprop="datePublished">2013-12-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/08/iOS-消息传递过程解析/">iOS 消息传递过程解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在iOS中调用一个方法，其实是调用一个方法实现的函数指针并传给他对象实例指针，一个Selector，还有函数用到的参数。在Objective-C 中，每一个方法调用其实都是转换成了调用objc_msgSend方法。</p>
<p><code>objc_msgSend</code>的调用过程如下：</p>
<p>0）首先检查消息接受对象是否为nil. 如果消息接受对象为nil，则触发nil-handler. 默认nil-handler是什么都不做的。</p>
<p>1）在垃圾回收环境中（Mac OS X）中，检查是否调用了（retain, release, autorelease, retainCount), 如果是，就返回self. 所以，这就意味着在垃圾回收机制中，retainCount 返回self。这时调用retainCount就会产生无限循环。</p>
<p>2）检查class的缓存中是否有该方法的实现，如果有，调用。</p>
<p>3）在类方法中是否有该方法，如果有就调用类方法的实现。</p>
<p>4）查看父类中是否有该方法实现，如果没有再查找父类的父类中有没有实现。如果找到了，调用。</p>
<p>5）调用<code>resolveInstanceMethod:</code>(或者resolveClassMethod:). 如果返回YES， 则调用。 该对象会有该方法的实现，因为它会调用class_addMethod.</p>
<p>6) 调用<code>forwardingTargetForSelector:</code>. 如果返回non-nil， 则对返回对象发消息。此处不会返回self，否则会进入无限循环。</p>
<p>7）调用<code>methodSignatureForSelector:</code>, 如果返回non-nil, 创建一个NSInvocation 并且将这个NSInvocation传递给forwardInvocation:.</p>
<p>8) 调用<code>doesNotRecognizeSelector:</code>. 默认实现就是抛一个异常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/12/08/iOS-消息传递过程解析/" data-id="cl4kp32xy000uvjz6lr2uyq8x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-KVO实现方式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/27/iOS-KVO实现方式/" class="article-date">
  <time datetime="2013-11-27T09:13:57.000Z" itemprop="datePublished">2013-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/27/iOS-KVO实现方式/">iOS KVO实现方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>KVO 也许是iOS中“最神奇”的部分了，因为你不需要在被观察对象中添加任何代码，就可以实现对被观察对象属性改变的通知。KVO究竟是怎么实现的？</p>
<p>KVO是通过Objective－C的runtime来实现的。当你第一次要对一个对象进行观察时，runtime会为你创建一个被观察对象class的subclass。在这个新创建的subclass中，KVO会复写所要观察属性的setter方法，然后转换被观察对象的isa指针，指向新创建的subclass，所以，你想要观察的对象，变成了KVO在runtime时创建的subclass。因为Apple不想让这种机制暴露，所以还会复写要观察对象的class方法，所以，当你调用class来判断该对象的class时，还会显示原对象的class类型，而不是subclass的类型。</p>
<p>继续探究</p>
<pre><code class="Objective-C">// gcc -o kvoexplorer -framework Foundation kvoexplorer.m&#10;&#10;#import &#60;Foundation/Foundation.h&#62;&#10;#import &#60;objc/runtime.h&#62;&#10;&#10;&#10;@interface TestClass : NSObject&#10;{&#10;    int x;&#10;    int y;&#10;    int z;&#10;}&#10;@property int x;&#10;@property int y;&#10;@property int z;&#10;@end&#10;@implementation TestClass&#10;@synthesize x, y, z;&#10;@end&#10;&#10;static NSArray *ClassMethodNames(Class c)&#10;{&#10;    NSMutableArray *array = [NSMutableArray array];&#10;&#10;    unsigned int methodCount = 0;&#10;    Method *methodList = class_copyMethodList(c, &#38;methodCount);&#10;    unsigned int i;&#10;    for(i = 0; i &#60; methodCount; i++)&#10;        [array addObject: NSStringFromSelector(method_getName(methodList[i]))];&#10;    free(methodList);&#10;&#10;    return array;&#10;}&#10;&#10;static void PrintDescription(NSString *name, id obj)&#10;{&#10;    NSString *str = [NSString stringWithFormat:&#10;        @&#34;%@: %@\n\tNSObject class %s\n\tlibobjc class %s\n\timplements methods &#60;%@&#62;&#34;,&#10;        name,&#10;        obj,&#10;        class_getName([obj class]),&#10;        class_getName(obj-&#62;isa),&#10;        [ClassMethodNames(obj-&#62;isa) componentsJoinedByString:@&#34;, &#34;]];&#10;    printf(&#34;%s\n&#34;, [str UTF8String]);&#10;}&#10;&#10;int main(int argc, char **argv)&#10;{&#10;    [NSAutoreleasePool new];&#10;&#10;    TestClass *x = [[TestClass alloc] init];&#10;    TestClass *y = [[TestClass alloc] init];&#10;    TestClass *xy = [[TestClass alloc] init];&#10;    TestClass *control = [[TestClass alloc] init];&#10;&#10;    [x addObserver:x forKeyPath:@&#34;x&#34; options:0 context:NULL];&#10;    [xy addObserver:xy forKeyPath:@&#34;x&#34; options:0 context:NULL];&#10;    [y addObserver:y forKeyPath:@&#34;y&#34; options:0 context:NULL];&#10;    [xy addObserver:xy forKeyPath:@&#34;y&#34; options:0 context:NULL];&#10;&#10;    PrintDescription(@&#34;control&#34;, control);&#10;    PrintDescription(@&#34;x&#34;, x);&#10;    PrintDescription(@&#34;y&#34;, y);&#10;    PrintDescription(@&#34;xy&#34;, xy);&#10;&#10;    printf(&#34;Using NSObject methods, normal setX: is %p, overridden setX: is %p\n&#34;,&#10;          [control methodForSelector:@selector(setX:)],&#10;          [x methodForSelector:@selector(setX:)]);&#10;    printf(&#34;Using libobjc functions, normal setX: is %p, overridden setX: is %p\n&#34;,&#10;          method_getImplementation(class_getInstanceMethod(object_getClass(control),&#10;                                   @selector(setX:))),&#10;          method_getImplementation(class_getInstanceMethod(object_getClass(x),&#10;                                   @selector(setX:))));&#10;&#10;    return 0;&#10;}
</code></pre>
<p>首先，定义一个TestClass，有3个属性。<br>然后定义一些工具函数。ClassMethodNames 通过Objective－C 的runtime函数，来返回当前class实现的方法名。</p>
<p>代码执行结果</p>
<pre><code><span class="attribute">control</span>: <span class="string">&lt;TestClass: 0x104b20&gt; NSObject class TestClass libobjc class TestClass implements methods &lt;setX:, x, setY:, y, setZ:, z&gt;</span>

<span class="oxygene">
x: &lt;TestClass: <span class="number">0</span>x103280&gt; NSObject <span class="keyword">class</span> TestClass libobjc <span class="keyword">class</span> NSKVONotifying_TestClass <span class="keyword">implements</span> methods &lt;setY:, setX:, <span class="keyword">class</span>, dealloc, _isKVOA&gt;

y: &lt;TestClass: <span class="number">0</span>x104b00&gt; NSObject <span class="keyword">class</span> TestClass libobjc <span class="keyword">class</span> NSKVONotifying_TestClass <span class="keyword">implements</span> methods &lt;setY:, setX:, <span class="keyword">class</span>, dealloc, _isKVOA&gt;

xy: &lt;TestClass: <span class="number">0</span>x104b10&gt; NSObject <span class="keyword">class</span> TestClass libobjc <span class="keyword">class</span> NSKVONotifying_TestClass <span class="keyword">implements</span> methods &lt;setY:, setX:, <span class="keyword">class</span>, dealloc, _isKVOA&gt;

<span class="keyword">Using</span> NSObject methods, normal setX: <span class="keyword">is</span> <span class="number">0</span>x195e, overridden setX: <span class="keyword">is</span> <span class="number">0</span>x195e

<span class="keyword">Using</span> libobjc functions, normal setX: <span class="keyword">is</span> <span class="number">0</span>x195e, overridden setX: <span class="keyword">is</span> <span class="number">0</span>x96a1a550</span>
</code></pre><p>可以看出，<br>0)TestClass 在runtime时变成了NSKVONotifying_TestClass</p>
<p>1)虽然x，y只观察了一个属性，但是NSKVONotifying_TestClass却实现了setY, setX方法。也就是说，一个类，KVO只会subclass一个KVO类，也就是NSKVONotifying_TestClass类。</p>
<p>2)NSKVONotifying_TestClass 覆写了class方法，来掩盖subclass的存在，还覆写了dealloc方法。除此之外，还有一个新的方法_isKVOA, 是Apple提供的一个私有方法，用于判断一个object是否生成动态subclass。</p>
<p>原文链接：<a href="http://www.mikeash.com/pyblog/friday-qa-2009-01-23.html" target="_blank" rel="external">http://www.mikeash.com/pyblog/friday-qa-2009-01-23.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/11/27/iOS-KVO实现方式/" data-id="cl4kp32y90016vjz6j30njo8f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-GCD-与-NSOperationQueue对比" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/26/iOS-GCD-与-NSOperationQueue对比/" class="article-date">
  <time datetime="2013-11-26T08:56:44.000Z" itemprop="datePublished">2013-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/26/iOS-GCD-与-NSOperationQueue对比/">iOS GCD 与 NSOperationQueue对比</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>NSOperationQueue 是在GCD基础上实现的，只不过是GCD更高一层的抽象。</li>
<li>GCD 只支持FIFO 的队列， 而NSOperationQueue可以调整队列的执行顺序。（通过调整权重）</li>
<li>NSOperationQueue可以在Operation间设置依赖关系，而GCD不可以。 如果一个Operation依赖另一个Operation所产生的数据的化，你可以设置一个Operation依赖于另一个Operation来实现， NSOperationQueue可以根据依赖关系，可以以正确的顺序执行Queue中的Operation。</li>
<li>NSOperationQueue支持KVO。 这就意味着你可以观察任务的状态属性。<br>以上几点并不是说在任何处理多任务时一定要选择NSOperationQueue， 因为NSOperationQueue在执行速度上会比GCD慢。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/11/26/iOS-GCD-与-NSOperationQueue对比/" data-id="cl4kp32yb001cvjz6tac3kze7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-获取本地设备IP地址" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/14/iOS-获取本地设备IP地址/" class="article-date">
  <time datetime="2013-11-14T08:17:05.000Z" itemprop="datePublished">2013-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/14/iOS-获取本地设备IP地址/">iOS 获取本地设备IP地址</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &#60;ifaddrs.h&#62;&#10;#import &#60;arpa/inet.h&#62;&#10;// Get IP Address&#10;- (NSString *)getIPAddress &#123;    &#10;  NSString *address = @&#34;error&#34;;&#10;  struct ifaddrs *interfaces = NULL;&#10;  struct ifaddrs *temp_addr = NULL;&#10;  int success = 0;&#10;  // retrieve the current interfaces - returns 0 on success&#10;  success = getifaddrs(&#38;interfaces);&#10;  if (success == 0) &#123;&#10;      // Loop through linked list of interfaces&#10;      temp_addr = interfaces;&#10;      while(temp_addr != NULL) &#123;&#10;          if(temp_addr-&#62;ifa_addr-&#62;sa_family == AF_INET) &#123;&#10;              // Check if interface is en0 which is the wifi connection on the iPhone&#10;              if([[NSString stringWithUTF8String:temp_addr-&#62;ifa_name] isEqualToString:@&#34;en0&#34;]) &#123;&#10;                  // Get NSString from C String&#10;                  address = [NSString stringWithUTF8String:inet_ntoa(((struct sockaddr_in *)temp_addr-&#62;ifa_addr)-&#62;sin_addr)];               &#10;              &#125;&#10;          &#125;&#10;          temp_addr = temp_addr-&#62;ifa_next;&#10;      &#125;&#10;  &#125;&#10;  // Free memory&#10;  freeifaddrs(interfaces);&#10;  return address;&#10;  &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/11/14/iOS-获取本地设备IP地址/" data-id="cl4kp32xx000svjz6f8lssaw6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-Crash类别总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/05/iOS-Crash类别总结/" class="article-date">
  <time datetime="2013-11-05T08:11:41.000Z" itemprop="datePublished">2013-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/05/iOS-Crash类别总结/">iOS Crash类别总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>EXC_BAD_ACCESS</strong></p>
<p>An EXC__BAD_ACCESS occurs whenever you try to access or send a message to a deallocated object. The most common cause of EXC_BAD_ACCESS is when you initialize a variable in one of your initializer methods but use the wrong ownership qualifier, which results in deallocation of your object. For example, you create an NSMutableArray of elements for your UITableViewController in the viewDidLoad method but set the ownership qualifier of the list to unsafe_unretained or assign instead of strong. Now in cellForRowAtIndexPath:, when you try to access the deallocated object, you’ll crash with a EXC_BAD_ACCESS. Debugging EXC_BAD_ACCESS is made easy with the NSZombiesEnabled environment variable.</p>
<p><strong>SIGSEGV</strong></p>
<p>A signal segment fault(SIGSEGV) is a more serious issue that the operating system raises. It occurs when there is a hardware failure or when you try to access a memory address that cannot be read or when you try to write to a protected address.</p>
<p>The first case, a hardware failure, is uncommon. When you try to read data stored in RAM and the RAM hardware at that location is faulty, you get a SIGSEGV. But more often than not, a SIGSEGV occurs for the latter two reasons. By default, code pages are protected from being written into and data pages are protected from being executed. When one of your pointers in your application points to a code page and tries to alter the value pointed to, you get a SIGSEGV. You also get a SIGSEGV when  you try to read the value of a pointer that was initialized to a garbage value pointing to an address that is not a valid memory location.</p>
<p>SIGSEGV faults are more tedious to debug, and the most common case reason a SIGSEGV happens is an incorrect typecast. Avoid hacking around with pointers or trying to a read a private data structure by advancing the pointer manually. When you do that and don’t advance the pointer to take care of the memory alignment or padding, you get a SIGSEGV.</p>
<p><strong>SIGBUS</strong></p>
<p>A signal bus(SIGBUS) error is a kind of bad memory access where the memory you tried to access is an invalid memory address. That is, the address pointed to is not a physical memory address at all. Both SIGSEGV and SIGBUS are subtypes of EXC_BAD_ACCESS.</p>
<p><strong>SIGTRAP</strong></p>
<p>SIGTRAP stands for signal trap. This is not really a crash signal. It’s sent when the processor executes a trap instruction. The LLDB debugger usually handles this signal and stops at a specified breakpoint. If you get a SIGTRAP for no apparent reason, a clean build will usually fix it.</p>
<p><strong>EXC_ARITHMETIC</strong></p>
<p>divide zero.</p>
<p><strong>SIGILL</strong></p>
<p>SIGILL stands for SIGNAL ILLEGAL INSTRUCTION. This happens when you try to execute an illegal instruction on the processor. You execute an illegal instruction when you’re trying to pass a function pointer to another function, but for one reason or other, the function pointer is corrupted and is pointing to a deallocated memory or a data segment. Sometimes you get an EXC_BAD<em>INSTRUCTION instead of SIGILL, and through both are synonymous, EXC</em>* are machine-independent equivalents of this signal.</p>
<p><strong>SIGABRT</strong></p>
<p>SIGABRT stands for SIGNAL ABORT. This is a more controlled crash where the operating system has detected a condition that is not safe and asks the process to perform cleanup if any is needed. There is no one silver bullet to help you debug the underlying error for this signal. Frameworks like cocos2d or UIKit often call the C function abort when certain preconditions are not met or when something really bad happens. When a SIGABRT occurs, the console usually has a wealth of information about what went wrong. Since it’s controlled crash, you can print the backtrace by typing bt into the LLDB console.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/11/05/iOS-Crash类别总结/" data-id="cl4kp32yc001evjz6zlec1z60" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-LLDB-console-debug总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/11/05/iOS-LLDB-console-debug总结/" class="article-date">
  <time datetime="2013-11-05T08:10:31.000Z" itemprop="datePublished">2013-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/05/iOS-LLDB-console-debug总结/">iOS LLDB console debug总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Xcode’s debugging console window is a full-featured LLDB debugging console. When your app is paused(at a breakpoint), the debugging console shows the LLDB command prompt. You can type any LLDB debugger common into the console to help you with debugging, including loading external python script.</p>
<p>The most frequently used command is po, which stands for print object. When your application is paused in debugger, you can print any variable that is in the current scope. This includes any stack variables, class variables, properties, ivars, and global variables. In short, any variable that is accessible by your application at the breakpoint can be accessed via the debugging console.</p>
<p><strong>Printing scalar variables</strong></p>
<p>when you’re dealing with scalars like integers or structs(CGRect, CGPoint, etc..), instead of using po, you use p, followed by the type of struct.</p>
<pre><code><span class="tag">p</span> (int) self<span class="class">.myAge</span>

<span class="tag">p</span> (CGPoint) self<span class="class">.view</span><span class="class">.center</span>
</code></pre><p><strong>Printing Registers</strong></p>
<p>Registers in your CPU are used for storing variables that have to be accessed frequently. Compilers optimize frequently used variables like the loop variable, method arguments, and return variables in the registers. When your app crashes for no apparent reason, probing the register for the method name or the selector name that crashed your app will be very useful.</p>
<pre><code>(lldb) <span class="keyword">register</span> <span class="keyword">read</span>
</code></pre><p>General Purpose Registers:</p>
<pre><code>  r0 = <span class="number">0x37c9cb21</span>  libobjc.A.dylib`objc_msgSend + <span class="number">1</span>

  r1 = <span class="number">0x37c9cb21</span>  libobjc.A.dylib`objc_msgSend + <span class="number">1</span>

  r2 = <span class="number">0x01b5c214</span>  <span class="string">"idKey"</span>

  r3 = <span class="number">0x01b5eb28</span>  <span class="string">"checkCurrentContactBean"</span>

  r4 = <span class="number">0x00000000</span>

  r5 = <span class="number">0x37c9cb21</span>  libobjc.A.dylib`objc_msgSend + <span class="number">1</span>

  r6 = <span class="number">0x27d09bd0</span>

  r7 = <span class="number">0x27d09bc8</span>

  r8 = <span class="number">0x01b5bbc4</span>  <span class="string">"view"</span>

  r9 = <span class="number">0x00000000</span>

 r10 = <span class="number">0x01b5e3f8</span>  <span class="string">"masterViewController"</span>

 r11 = <span class="number">0x00000000</span>

 r12 = <span class="number">0x3a11c1d0</span>  (<span class="keyword">void</span> *)<span class="number">0x382c3959</span>: _os_lock_handoff_unlock$VARIANT$mp + <span class="number">1</span>

  sp = <span class="number">0x27d09358</span>

  lr = <span class="number">0x37cacabb</span>  libobjc.A.dylib`objc_object::sidetable_release(<span class="keyword">bool</span>) + <span class="number">95</span>

  pc = <span class="number">0x002cce40</span>  iPoS_IOS`-[PersonMainForm viewWillAppear:] + <span class="number">232</span> at PersonMainForm.m:<span class="number">59</span>

cpsr = <span class="number">0x60000030</span>
</code></pre><p>Your output may vary, butt pay close attention to the wax, dcx, and esi on the simulator or r0-r4 registers when running on a device. These registers store some of the values that you’re interested in. In the Simulator, the dcx register holds the name of the selector that is called when your app crashed. You print an individual register to console by specifying the register name as shown below<br>    register read ecx.</p>
<p>You can also specify multiple registers like</p>
<pre><code><span class="keyword">register</span>  <span class="keyword">read</span> eax ecx.
</code></pre><p>The dcx register on Intel architecture and the r15 register on ARM architecture hold the program counter. Printing the address of the program counter will show the last executed instruction. Similarly, wax(r0 on ARM) holds the receiver address, ecx (r4 on ARM) and holds the selector that was called last. The arguments to the methods are stored in registers r1-r3. If your selector has more than three arguments, they are stored on stack, accessible via the stack pointer(r13). sp, lr, and pc are actually aliases to the r13,r14 and r15 register, respectively. Hence, register read r13 is equivalent to register read sp.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/11/05/iOS-LLDB-console-debug总结/" data-id="cl4kp32y80014vjz6c0dplvw9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-KVO-Key-Value-Observing-总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/iOS-KVO-Key-Value-Observing-总结/" class="article-date">
  <time datetime="2013-10-29T03:19:27.000Z" itemprop="datePublished">2013-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/iOS-KVO-Key-Value-Observing-总结/">iOS KVO(Key-Value Observing)总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>KVO 允许观察者对被观察对象的特定属性的值进行观察，如果被观察对象的特定值更改，会触发一个<code>observeValueForKeyPath:(NSString <em>)keyPath ofObject:(id)object change:(NSDictionary </em>)change context:(void *)context</code>的方法。</p>
<p>KVO与NSNotificationCenter有很多相似的地方。首先，KVO需要给被观察者添加观察者，<code>addObserver:forKeyPath:options:context:</code>.取消观察，用<code>removeObserver:forKeyPath:context:</code>.</p>
<p>KVO与NSNotificationCenter不同的是，你不用去手动调用某个方法，如果没有观察者到情况下，广播是会发送到，而KVO则不会执行。KVO只会在有观察者对象到情况下才会执行通知方法。这使得KVO在某些对性能要求很高的地方，是一个很好到选择。</p>
<p>注册观察者</p>
<pre><code>- (<span class="keyword">void</span>)registerAsObserver
{
  [object addObserver:inspector
      forKeyPath:@<span class="string">"someProperty"</span>
        <span class="keyword">options</span>:NSKeyValueObservingOptionNew
        comtext:<span class="keyword">NULL</span>];
}
</code></pre><p>接受通知</p>
<pre><code><span class="tag">-</span> (void)<span class="tag">observeValueForKeyPath</span>:(NSString *)<span class="tag">keyPath</span>
                   <span class="tag">ofObject</span>:(id)<span class="tag">object</span>
                      <span class="tag">change</span>:(NSDictionary *)<span class="tag">change</span>
                      <span class="tag">context</span>:(void *)<span class="tag">context</span>
{
    <span class="tag">if</span>(someCondition)
    {
       <span class="comment">//do something</span>
    }

    <span class="comment">/*
      Be sure to call the superclass's implementation
      * if it implements it *
      NSObject does not implement the method.
     */</span>
    <span class="attr_selector">[super observeValueForKeyPath:keyPath
                         ofObject:object
                          change:change
                           context:context]</span>;
}
</code></pre><p>取消观察者</p>
<pre><code>- (<span class="typename">void</span>)unregisterForChangeNotification
{
   [observedObject <span class="string">removeObserver:</span>inspector <span class="string">forKeyPath:</span>@<span class="string">"someProperty"</span>];
}
</code></pre><p>关于如何查看一个对象是否有观察者，</p>
<p>在网上查了一下，有一个<code>[object observationInfo]</code>的方法，如果没有观察者返回nil.</p>
<p>对对象删除观察者还可以用</p>
<pre><code><span class="variable">@try</span>
{
  <span class="attr_selector">[object removeObserver:inspector forKeyPath:@"someProperty"]</span>;
}
<span class="variable">@catch</span> (NSException *e)
{
}
</code></pre><p>来防止对一个没有观察者的对象删除造成程序crash.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/10/29/iOS-KVO-Key-Value-Observing-总结/" data-id="cl4kp32y90018vjz61ucrx7y8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-block-总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/18/iOS-block-总结/" class="article-date">
  <time datetime="2013-10-18T08:20:28.000Z" itemprop="datePublished">2013-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/18/iOS-block-总结/">iOS block 总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Block objects are a C-based language feature that you can use in your C, Objective-C, and C++ code. Blocks make it easy to define a self-contained unit of work.</p>
<p>One of the key advantages of blocks is their ability to use variables from outside their own lexical scope. When you define a block inside a function or method, the block acts as a traditional code block would in some ways. For example, a block can read the values of variables defined in the parent scope. Variables accessed by the block are copied to the block data structure on the heap so that the block acan access them later. When blocks are added to a dispatch queue, these values must typically be left in a read-only format. However, blocks that are executed synchronously can also use variables that have the __block keyword prepended to return data back to the parent’s calling scope.</p>
<p>You declare blocks inline with your code using a syntax that is similar to the syntax used for function pointers. The main difference between a block and a fuction pointer is that the block name is preceded with a caret (^) instead of an asterisk (*). Like a function pointer, you can pass arguments to a block and receive a return value from it.</p>
<pre><code><span class="keyword">int</span> x = <span class="number">123</span>;
<span class="keyword">int</span> y = <span class="number">456</span>;

<span class="comment">// Block declaration and assignment</span>
<span class="keyword">void</span> (^aBlock)(<span class="keyword">int</span>) = ^(<span class="keyword">int</span> z)
{
  <span class="built_in">printf</span>(<span class="string">"%d %d %d\n"</span>, x, y, z);
};

<span class="comment">// Execute the block</span>
aBlock(<span class="number">789</span>); <span class="comment">//pritns: 123 456 789</span>
</code></pre><p>The following is a summary of some of the key guidelines you should consider when designing your blocks:</p>
<ul>
<li>For blocks that you plan to perform asynchronously using a dispatch queue, it is safe to capture scalar variables from the parent function or method and use them in the block. However, you should not try to capture large structures or other pointer-based variables that are allocated and deleted by the calling context. By the time your block is executed, the memory referenced by that pointer may be gone. Of course, it is safe to allocate memory yourself and explicitly hand off ownership of that memory to the block.</li>
<li>Dispatch queues copy blocks that  are added to them, and they release blocks when they finish executing. In other words, you do not need to explicitly copy blocks before adding them to a queue.</li>
<li>Although queues are more efficient than raw threads at executing small tasks, there is still overhead to creating blocks and executing them on a queue. If a block does too little work, it may be cheaper to execute it inline than dispatch it to a queue. The way to tell if a block is doing too little work is to gather metrics for each path using the performance tools and compare them.</li>
<li>Do not cache data relative to the underlying thread and expect that data to be accessible from a different block. If tasks in the same queue need to share data, use the context  pointer of the dispatch queue to store the data instead.</li>
<li>If your block creates more than a few Objective-C objects. you might want to enclose parts of your block’s code in an @autorelease block to handle the memory management for those objects. Although GCD dispatch queues have their own autorelease pools, they make no guarantees as to when those pools are drained. If your application is memory constrained, creating your own autorelease pool allows you to free up the memory for autoreleased objects at more regular intervals.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/10/18/iOS-block-总结/" data-id="cl4kp32y50010vjz6g67jdc6r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLite/">SQLite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/">Unix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/combine/">combine</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-archlinux/">linux, archlinux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phonegap/">phonegap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reading/">reading</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift-source-code/">swift source code</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器配置文件/">编辑器配置文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 17.5px;">C</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/combine/" style="font-size: 12.5px;">combine</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/linux-archlinux/" style="font-size: 10px;">linux, archlinux</a> <a href="/tags/phonegap/" style="font-size: 10px;">phonegap</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/reading/" style="font-size: 12.5px;">reading</a> <a href="/tags/swift-source-code/" style="font-size: 15px;">swift source code</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/编辑器配置文件/" style="font-size: 10px;">编辑器配置文件</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">六月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/19/悉达多/">悉达多</a>
          </li>
        
          <li>
            <a href="/2022/06/13/信心/">信心</a>
          </li>
        
          <li>
            <a href="/2022/06/04/Combine-Publisher/">Combine: Publisher</a>
          </li>
        
          <li>
            <a href="/2022/05/30/Combine-Introduction/">Combine: Introduction</a>
          </li>
        
          <li>
            <a href="/2022/05/13/Swift-Source-Code-ContiguousArray/">Swift Source Code: ContiguousArray</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Anyuan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">home</a>
  
    <a href="/archives" class="mobile-nav-link">archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>