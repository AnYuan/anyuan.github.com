<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Combine: Publisher | Anyuan&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="PublisherThe publisher is the provider of data.
Empty123456789101112131415161718192021222324252627282930313233343536373839404142/// A publisher that never publishes any values, and optionally finishes">
<meta property="og:type" content="article">
<meta property="og:title" content="Combine: Publisher">
<meta property="og:url" content="http://yoursite.com/2022/06/04/Combine-Publisher/index.html">
<meta property="og:site_name" content="Anyuan's blog">
<meta property="og:description" content="PublisherThe publisher is the provider of data.
Empty123456789101112131415161718192021222324252627282930313233343536373839404142/// A publisher that never publishes any values, and optionally finishes">
<meta property="og:updated_time" content="2022-06-19T10:44:09.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Combine: Publisher">
<meta name="twitter:description" content="PublisherThe publisher is the provider of data.
Empty123456789101112131415161718192021222324252627282930313233343536373839404142/// A publisher that never publishes any values, and optionally finishes">
  
    <link rel="alternative" href="/atom.xml" title="Anyuan&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anyuan&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">home</a>
        
          <a class="main-nav-link" href="/archives">archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Combine-Publisher" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/06/04/Combine-Publisher/" class="article-date">
  <time datetime="2022-06-04T06:10:13.000Z" itemprop="datePublished">2022-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Combine: Publisher
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Publisher">Publisher</h1><p>The publisher is the provider of data.</p>
<h2 id="Empty">Empty</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that never publishes any values, and optionally finishes immediately.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// You can create a ”Never” publisher — one which never sends values and never finishes or fails — with the initializer `Empty(completeImmediately: false)`.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Empty</span>&lt;<span class="title">Output</span>, <span class="title">Failure</span>&gt; : <span class="title">Publisher</span>, <span class="title">Equatable</span> <span class="title">where</span> <span class="title">Failure</span> : <span class="title">Error</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates an empty publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter completeImmediately: A Boolean value that indicates whether the publisher should immediately finish.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(completeImmediately: <span class="type">Bool</span> = <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates an empty publisher with the given completion behavior and output and failure types.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Use this initializer to connect the empty publisher to subscribers or other publishers that have specific output and failure types.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - completeImmediately: A Boolean value that indicates whether the publisher should immediately finish.</span></span><br><span class="line">    <span class="comment">///   - outputType: The output type exposed by this publisher.</span></span><br><span class="line">    <span class="comment">///   - failureType: The failure type exposed by this publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(completeImmediately: <span class="type">Bool</span> = <span class="literal">true</span>, outputType: <span class="type">Output</span>.<span class="type">Type</span>, failureType: <span class="type">Failure</span>.<span class="type">Type</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A Boolean value that indicates whether the publisher immediately sends a completion.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// If `true`, the publisher finishes immediately after sending a subscription to the subscriber. If `false`, it never completes.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> completeImmediately: <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span>, <span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">S</span> : <span class="type">Subscriber</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value that indicates whether two publishers are equivalent.</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: An `Empty` instance to compare.</span></span><br><span class="line">    <span class="comment">///   - rhs: Another `Empty` instance to compare.</span></span><br><span class="line">    <span class="comment">/// - Returns: `true` if the two publishers have equal `completeImmediately` properties; otherwise `false`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="func"><span class="keyword">func</span> == <span class="params">(lhs: Empty&lt;Output, Failure&gt;, rhs: Empty&lt;Output, Failure&gt;)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Just">Just</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that emits an output to each subscriber just once, and then finishes.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// You can use a ``Just`` publisher to start a chain of publishers. A ``Just`` publisher is also useful when replacing a value with ``Publishers/Catch``.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// In contrast with &lt;doc://com.apple.documentation/documentation/Swift/Result/Publisher&gt;, a ``Just`` publisher can’t fail with an error. And unlike &lt;doc://com.apple.documentation/documentation/Swift/Optional/Publisher&gt;, a ``Just`` publisher always produces a value.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Just</span>&lt;<span class="title">Output</span>&gt; : <span class="title">Publisher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of errors this publisher might publish.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Use `Never` if this `Publisher` does not publish errors.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Failure</span> = <span class="type">Never</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The one element that the publisher emits.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> output: <span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initializes a publisher that emits the specified output just once.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter output: The one element that the publisher emits.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> output: <span class="type">Output</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span>, <span class="type">S</span> : <span class="type">Subscriber</span>, <span class="type">S</span>.<span class="type">Failure</span> == <span class="type">Just</span>&lt;<span class="type">Output</span>&gt;.<span class="type">Failure</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Future">Future</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that eventually produces a single value and then finishes or fails.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Future</span>&lt;<span class="title">Output</span>, <span class="title">Failure</span>&gt; : <span class="title">Publisher</span> <span class="title">where</span> <span class="title">Failure</span> : <span class="title">Error</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A type that represents a closure to invoke in the future, when an element or error is available.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The promise closure receives one parameter: a `Result` that contains either a single element published by a ``Future``, or an error.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Promise</span> = (<span class="type">Result</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;) -&gt; <span class="type">Void</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a publisher that invokes a promise closure when the publisher emits an element.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter attemptToFulfill: A ``Future/Promise`` that the publisher invokes when the publisher emits an element or terminates with an error.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> attemptToFulfill: @escaping (@escaping <span class="type">Future</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;.<span class="type">Promise</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span>, <span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">S</span> : <span class="type">Subscriber</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Deferrred">Deferrred</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that awaits subscription before running the supplied closure to create a publisher for the new subscriber.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Deferred</span>&lt;<span class="title">DeferredPublisher</span>&gt; : <span class="title">Publisher</span> <span class="title">where</span> <span class="title">DeferredPublisher</span> : <span class="title">Publisher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of values published by this publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">DeferredPublisher</span>.<span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of errors this publisher might publish.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Failure</span> = <span class="type">DeferredPublisher</span>.<span class="type">Failure</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The closure to execute when this deferred publisher receives a subscription.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The publisher returned by this closure immediately receives the incoming subscription.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> createPublisher: () -&gt; <span class="type">DeferredPublisher</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a deferred publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter createPublisher: The closure to execute when calling `subscribe(_:)`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(createPublisher: @escaping () -&gt; <span class="type">DeferredPublisher</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">S</span> : <span class="type">Subscriber</span>, <span class="type">DeferredPublisher</span>.<span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">DeferredPublisher</span>.<span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Fail">Fail</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that immediately terminates with the specified error.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Fail</span>&lt;<span class="title">Output</span>, <span class="title">Failure</span>&gt; : <span class="title">Publisher</span> <span class="title">where</span> <span class="title">Failure</span> : <span class="title">Error</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a publisher that immediately terminates with the specified failure.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter error: The failure to send when terminating the publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(error: <span class="type">Failure</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates publisher with the given output type, that immediately terminates with the specified failure.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Use this initializer to create a `Fail` publisher that can work with subscribers or publishers that expect a given output type.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - outputType: The output type exposed by this publisher.</span></span><br><span class="line">    <span class="comment">///   - failure: The failure to send when terminating the publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(outputType: <span class="type">Output</span>.<span class="type">Type</span>, failure: <span class="type">Failure</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The failure to send when terminating the publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> error: <span class="type">Failure</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span>, <span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">S</span> : <span class="type">Subscriber</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Sequence">Sequence</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Publishers</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A publisher that publishes a given sequence of elements.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// When the publisher exhausts the elements in the sequence, the next request causes the publisher to finish.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Sequence</span>&lt;<span class="title">Elements</span>, <span class="title">Failure</span>&gt; : <span class="title">Publisher</span> <span class="title">where</span> <span class="title">Elements</span> : <span class="title">Sequence</span>, <span class="title">Failure</span> : <span class="title">Error</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// The kind of values published by this publisher.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">Elements</span>.<span class="type">Element</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/// The sequence of elements to publish.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">let</span> sequence: <span class="type">Elements</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Creates a publisher for a sequence of elements.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// - Parameter sequence: The sequence of elements to publish.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">init</span>(sequence: <span class="type">Elements</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">S</span> : <span class="type">Subscriber</span>, <span class="type">Elements</span>.<span class="type">Element</span> == <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Record">Record</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that allows for recording a series of inputs and a completion, for later playback to each subscriber.</span></span><br><span class="line"><span class="preprocessor">@available</span>(macOS <span class="number">10.15</span>, iOS <span class="number">13.0</span>, tvOS <span class="number">13.0</span>, watchOS <span class="number">6.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Record</span>&lt;<span class="title">Output</span>, <span class="title">Failure</span>&gt; : <span class="title">Publisher</span> <span class="title">where</span> <span class="title">Failure</span> : <span class="title">Error</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The recorded output and completion.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> recording: <span class="type">Record</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;.<span class="type">Recording</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a publisher to interactively record a series of outputs and a completion.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter record: A recording instance that can be retrieved after completion to create new record publishers to replay the recording.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(record: (<span class="keyword">inout</span> <span class="type">Record</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;.<span class="type">Recording</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a record publisher from an existing recording.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter recording: A previously-recorded recording of published elements and a completion.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(recording: <span class="type">Record</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;.<span class="type">Recording</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a record publisher to publish the provided elements, followed by the provided completion value.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - output: An array of output elements to publish.</span></span><br><span class="line">    <span class="comment">///   - completion: The completion value with which to end publishing.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(output: [<span class="type">Output</span>], completion: <span class="type">Subscribers</span>.<span class="type">Completion</span>&lt;<span class="type">Failure</span>&gt;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span>, <span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">S</span> : <span class="type">Subscriber</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A recorded sequence of outputs, followed by a completion value.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Recording</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Input</span> = <span class="type">Output</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/// The output which will be sent to a `Subscriber`.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">var</span> output: [<span class="type">Output</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// The completion which will be sent to a `Subscriber`.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">var</span> completion: <span class="type">Subscribers</span>.<span class="type">Completion</span>&lt;<span class="type">Failure</span>&gt; &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Set up a recording in a state ready to receive output.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Set up a complete recording with the specified output and completion.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">init</span>(output: [<span class="type">Output</span>], completion: <span class="type">Subscribers</span>.<span class="type">Completion</span>&lt;<span class="type">Failure</span>&gt; = .finished)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Add an output to the recording.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// A `fatalError` will be raised if output is added after adding completion.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(<span class="number">_</span> input: Record&lt;Output, Failure&gt;.Recording.Input)</span></span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Add a completion to the recording.</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// A `fatalError` will be raised if more than one completion is added.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(completion: Subscribers.Completion&lt;Failure&gt;)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Share">Share</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that shares the output of an upstream publisher with multiple subscribers.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// This publisher type supports multiple subscribers, all of whom receive unchanged elements and completion states from the upstream publisher.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///  &gt; Tip: ``Publishers/Share`` is effectively a combination of the ``Publishers/Multicast`` and ``PassthroughSubject`` publishers, with an implicit ``ConnectablePublisher/autoconnect()``.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Be aware that ``Publishers/Share`` is a class rather than a structure like most other publishers. Use this type when you need a publisher instance that uses reference semantics.</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Share</span>&lt;<span class="title">Upstream</span>&gt; : <span class="title">Publisher</span>, <span class="title">Equatable</span> <span class="title">where</span> <span class="title">Upstream</span> : <span class="title">Publisher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of values published by this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// This publisher uses its upstream publisher's output type.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">Upstream</span>.<span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of errors this publisher might publish.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// This publisher uses its upstream publisher's failure type.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Failure</span> = <span class="type">Upstream</span>.<span class="type">Failure</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The publisher from which this publisher receives elements.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">let</span> upstream: <span class="type">Upstream</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a publisher that shares the output of an upstream publisher with multiple subscribers.</span></span><br><span class="line">    <span class="comment">/// - Parameter upstream: The publisher from which this publisher receives elements.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(upstream: <span class="type">Upstream</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">S</span> : <span class="type">Subscriber</span>, <span class="type">Upstream</span>.<span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">Upstream</span>.<span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Returns a Boolean value that indicates whether two publishers are equivalent.</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - lhs: A `Share` publisher to compare for equality.</span></span><br><span class="line">    <span class="comment">///   - rhs: Another `Share` publisher to compare for equality.</span></span><br><span class="line">    <span class="comment">/// - Returns: `true` if the publishers have reference equality (`===`); otherwise `false`.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="func"><span class="keyword">func</span> == <span class="params">(lhs: Publishers.Share&lt;Upstream&gt;, rhs: Publishers.Share&lt;Upstream&gt;)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Multicast">Multicast</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A publisher that uses a subject to deliver elements to multiple subscribers.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Use a multicast publisher when you have multiple downstream subscribers, but you want upstream publishers to only process one ``Subscriber/receive(_:)`` call per event.</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Multicast</span>&lt;<span class="title">Upstream</span>, <span class="title">SubjectType</span>&gt; : <span class="title">ConnectablePublisher</span> <span class="title">where</span> <span class="title">Upstream</span> : <span class="title">Publisher</span>, <span class="title">SubjectType</span> : <span class="title">Subject</span>, <span class="title">Upstream</span>.<span class="title">Failure</span> == <span class="title">SubjectType</span>.<span class="title">Failure</span>, <span class="title">Upstream</span>.<span class="title">Output</span> == <span class="title">SubjectType</span>.<span class="title">Output</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of values published by this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// This publisher uses its upstream publisher's output type.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">Upstream</span>.<span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The kind of errors this publisher might publish.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// This publisher uses its upstream publisher's failure type.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Failure</span> = <span class="type">Upstream</span>.<span class="type">Failure</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The publisher from which this publisher receives its elements.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">let</span> upstream: <span class="type">Upstream</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A closure that returns a subject each time a subscriber attaches to the multicast publisher.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">let</span> createSubject: () -&gt; <span class="type">SubjectType</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Creates a multicast publisher that applies a closure to create a subject that delivers elements to subscribers.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter createSubject: A closure that returns a ``Subject`` each time a subscriber attaches to the multicast publisher.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(upstream: <span class="type">Upstream</span>, createSubject: @escaping () -&gt; <span class="type">SubjectType</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Attaches the specified subscriber to this publisher.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Implementations of ``Publisher`` must implement this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="generics">&lt;S&gt;</span><span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">S</span> : <span class="type">Subscriber</span>, <span class="type">SubjectType</span>.<span class="type">Failure</span> == <span class="type">S</span>.<span class="type">Failure</span>, <span class="type">SubjectType</span>.<span class="type">Output</span> == <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Connects to the publisher, allowing it to produce elements, and returns an instance with which to cancel publishing.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Returns: A ``Cancellable`` instance that you use to cancel publishing.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">connect</span><span class="params">()</span></span> -&gt; <span class="type">Cancellable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConnectablePublisher">ConnectablePublisher</h2><h3 id="connect">connect</h3><p>某些情况下，我们希望在<code>Publisher</code>产生数据前对其进行相关配置，而不是当有<code>Subscriber</code>时，就直接开始产生数据。</p>
<p>Apple文档上提供了一个例子，就是当连个<code>Subscriber</code>要share一个<code>DataTaskPublisher</code>, 在正常的<code>Publisher</code>情况下，当第一个<code>Subscriber</code>进行订阅时，Task就会启动，这样有可能在第二个<code>Subscriber</code>订阅时，已经错过了<code>receiveValue</code>事件。所以我们需要<code>ConnectablePublisher</code>能在等待一个<code>connect</code>事件后，才开始产生数据，而不是有订阅就开始产生数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://example.com/"</span>)!</span><br><span class="line"><span class="keyword">let</span> connectable = <span class="type">URLSession</span>.shared</span><br><span class="line">    .dataTaskPublisher(<span class="keyword">for</span>: url)</span><br><span class="line">    .<span class="built_in">map</span>() &#123; $<span class="number">0</span>.data &#125;</span><br><span class="line">    .<span class="keyword">catch</span>() &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">Just</span>(<span class="type">Data</span>() )&#125;</span><br><span class="line">    .share()</span><br><span class="line">    .makeConnectable()</span><br><span class="line"></span><br><span class="line">cancellable1 = connectable</span><br><span class="line">    .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">"Received completion 1: <span class="subst">\($<span class="number">0</span>)</span>."</span>) &#125;,</span><br><span class="line">          receiveValue: &#123; <span class="built_in">print</span>(<span class="string">"Received data 1: <span class="subst">\($<span class="number">0</span>.<span class="built_in">count</span>)</span> bytes."</span>) &#125;)</span><br><span class="line"></span><br><span class="line"><span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.cancellable2 = connectable</span><br><span class="line">        .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">"Received completion 2: <span class="subst">\($<span class="number">0</span>)</span>."</span>) &#125;,</span><br><span class="line">              receiveValue: &#123; <span class="built_in">print</span>(<span class="string">"Received data 2: <span class="subst">\($<span class="number">0</span>.<span class="built_in">count</span>)</span> bytes."</span>) &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.connection = connectable.connect()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="autoconnect">autoconnect</h3><p>在某些场景下，像<code>Timer.TimerPublisher</code>, 每次使用前需要显示调用<code>connect</code>会显得很麻烦，当你根本不需要其他多余配置，或者有多个订阅者。在这种情况下，我们可以使用<code>autoconnect</code>。.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cancellable = <span class="type">Timer</span>.publish(every: <span class="number">1</span>, on: .main, <span class="keyword">in</span>: .<span class="keyword">default</span>)</span><br><span class="line">    .autoconnect()</span><br><span class="line">    .sink() &#123; date <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">"Date now: <span class="subst">\(date)</span>"</span>)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/06/04/Combine-Publisher/" data-id="cl4kp32yz002qvjz6zlu1lag7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/combine/">combine</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/06/13/信心/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          信心
        
      </div>
    </a>
  
  
    <a href="/2022/05/30/Combine-Introduction/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Combine: Introduction</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLite/">SQLite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/">Unix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/combine/">combine</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-archlinux/">linux, archlinux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phonegap/">phonegap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reading/">reading</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift-source-code/">swift source code</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器配置文件/">编辑器配置文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 17.5px;">C</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/combine/" style="font-size: 12.5px;">combine</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/linux-archlinux/" style="font-size: 10px;">linux, archlinux</a> <a href="/tags/phonegap/" style="font-size: 10px;">phonegap</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/reading/" style="font-size: 12.5px;">reading</a> <a href="/tags/swift-source-code/" style="font-size: 15px;">swift source code</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/编辑器配置文件/" style="font-size: 10px;">编辑器配置文件</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">六月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/19/悉达多/">悉达多</a>
          </li>
        
          <li>
            <a href="/2022/06/13/信心/">信心</a>
          </li>
        
          <li>
            <a href="/2022/06/04/Combine-Publisher/">Combine: Publisher</a>
          </li>
        
          <li>
            <a href="/2022/05/30/Combine-Introduction/">Combine: Introduction</a>
          </li>
        
          <li>
            <a href="/2022/05/13/Swift-Source-Code-ContiguousArray/">Swift Source Code: ContiguousArray</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Anyuan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">home</a>
  
    <a href="/archives" class="mobile-nav-link">archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>