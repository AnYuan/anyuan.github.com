<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Anyuan&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="Anyuan's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Anyuan's blog">
<meta property="og:description" content="记录点滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Anyuan's blog">
<meta name="twitter:description" content="记录点滴">
  
    <link rel="alternative" href="/atom.xml" title="Anyuan&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Anyuan&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">home</a>
        
          <a class="main-nav-link" href="/archives">archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Combine-Introduction" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/30/Combine-Introduction/" class="article-date">
  <time datetime="2022-05-30T10:56:20.000Z" itemprop="datePublished">2022-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/30/Combine-Introduction/">Combine: Introduction</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Combine">Combine</h1><p>A unified, declarative API for processing values over time</p>
<ul>
<li>Callbacks,</li>
<li>Closures, </li>
<li>Notifications, </li>
<li>Key Value Observing</li>
</ul>
<h2 id="Features">Features</h2><ul>
<li>Generic</li>
<li>Type safe</li>
<li>Composition first</li>
<li>Request driven</li>
</ul>
<h2 id="Key_Concepts">Key Concepts</h2><h3 id="Publisher">Publisher</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">  associatedtype <span class="type">Output</span></span><br><span class="line">  associatedtype <span class="type">Failure</span>: <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">subscribe</span><span class="generics">&lt;S: Subscriber&gt;</span><span class="params">(<span class="number">_</span> subscriber: S)</span></span> <span class="keyword">where</span> <span class="type">S</span>.<span class="type">Input</span> == <span class="type">Output</span>, <span class="type">S</span>.<span class="type">Failure</span> == <span class="type">Failure</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Recipe for an event stream</li>
<li>Operators describe new publishers from existing</li>
<li>Strongly typed values/errors over time</li>
<li>Can be synchronous or asynchronous</li>
<li>Can attach compatible Subscribers</li>
</ul>
<h3 id="Subscriber">Subscriber</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Subscriber</span> </span>&#123;</span><br><span class="line">  associatedtype <span class="type">Input</span></span><br><span class="line">  associatedtype <span class="type">Failure</span>: <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// once</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(subscription: Subscription)</span></span></span><br><span class="line">  <span class="comment">// zero or More values</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(<span class="number">_</span> input: Input)</span></span> -&gt; <span class="type">Subscribers</span>.<span class="type">Demaind</span></span><br><span class="line">  <span class="comment">// At most one completion</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(completion: Subscribers.Completion&lt;Failure&gt;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Receives values and a completion</li>
<li>Reference type</li>
<li><p>The Pattern</p>
<ul>
<li><code>Subscriber</code> is attached to <code>Publisher</code></li>
<li><code>Publisher</code> sends a Subscription</li>
<li><code>Subscriber</code> requests N values</li>
<li><code>Publisher</code> sends N values or less</li>
<li><code>Publisher</code> sends completion</li>
</ul>
</li>
<li><p>Kinds of Subscribers</p>
<ul>
<li><p>Key Path Assignment</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> trickNamePublisher = ... <span class="comment">// Publisher of &lt;String, Never&gt;</span></span><br><span class="line"><span class="keyword">let</span> canceller = trickNamePublisher.assign(to: \.someProperty, on: someObject)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">canceller.cancel()</span><br></pre></td></tr></table></figure>
</li>
<li><p>Sinks</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> trickNamePublisher = ... <span class="comment">// Publisher of &lt;String, Never&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> canceller = trickNamePublisher.sink &#123; trickName <span class="keyword">in</span></span><br><span class="line"><span class="comment">// Do something with trickName</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Subjects</p>
<ul>
<li>Passthrough</li>
<li>CurrentValue</li>
</ul>
</li>
<li>SwiftUI        </li>
</ul>
</li>
</ul>
<h3 id="Operators">Operators</h3><ul>
<li>Adopts <code>Publisher</code></li>
<li>Describes a behavior for changing values</li>
<li>Subscribes to a <code>Publisher</code> (“upstream”)</li>
<li>Sends result to a <code>Subscriber</code> (“downstream”)</li>
<li>Value type</li>
<li>Declarative Operator API<ul>
<li>Functional transformations</li>
<li>List operations</li>
<li>Error handling</li>
<li>Thread or queue movement</li>
<li>Scheduling and time</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/05/30/Combine-Introduction/" data-id="cl3sosysj002lt0z6led9nuk2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/combine/">combine</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Swift-Source-Code-ContiguousArray" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/13/Swift-Source-Code-ContiguousArray/" class="article-date">
  <time datetime="2022-05-13T11:39:51.000Z" itemprop="datePublished">2022-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/13/Swift-Source-Code-ContiguousArray/">Swift Source Code: ContiguousArray</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ContiguousArray">ContiguousArray</h1><p>A contiguously stored array.</p>
<p><code>ContiguousArray&lt;Element&gt;</code> is the fastest and simplest of the three(ContiguousArray, Array, ArraySlice) – use this when you need “C array” performance. The elements of a <code>ContiguousArray</code> are always stored contiguously in memory.</p>
<p>The <code>ContiguousArray</code> type is a specialized array that always stores its elements in a contiguous region of memory. This contrasts with <code>Array</code>, which can store its elements in either a contiguous region of memory or an <code>NSArray</code> instance if its <code>Element</code> type is a class or <code>@objc</code> protocol.</p>
<p>If your array’s <code>Element</code> type is a class or <code>@objc</code> protocol and you do not need to bridge the array to <code>NSArray</code> or pass the array to Objective-C APIs, using <code>ContiguousArray</code> may be more efficient and have more predictable performance than <code>Array</code>. </p>
<p>If the array’s <code>Element</code> type is a struct or enumeration, <code>Array</code> and <code>ContiguousArray</code> should have similar efficiency.</p>
<p><code>ContiguousArray</code> 是对 <code>_buffer: _ContiguousArrayBuffer&lt;Element&gt;</code> 的一个封装.</p>
<p><code>_buffer</code> 是一个对 <code>_storage: __ContiguousArrayStorageBase</code>的封装.</p>
<h2 id="Types">Types</h2><h3 id="ContiguousArray-1">ContiguousArray</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ContiguousArray</span>&lt;<span class="title">Element</span>&gt;: <span class="title">_DestructorSafeContainer</span> </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">typealias</span> _Buffer = _ContiguousArrayBuffer&lt;<span class="type">Element</span>&gt;</span><br><span class="line"></span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _buffer: _Buffer</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Initialization from an existing buffer does not have "array.init"</span></span><br><span class="line">  <span class="comment">/// semantics because the caller may retain an alias to buffer.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(_buffer: _Buffer) &#123;</span><br><span class="line">    <span class="keyword">self</span>._buffer = _buffer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="_ContiguousArrayBuffer:__ArrayBufferProtocol">_ContiguousArrayBuffer<element>: _ArrayBufferProtocol</element></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@usableFromInline</span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">struct</span> <span class="title">_ContiguousArrayBuffer</span>&lt;<span class="title">Element</span>&gt;: <span class="title">_ArrayBufferProtocol</span> </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _storage: __ContiguousArrayStorageBase</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>//  __ContiguousArrayStorageBase supplies the implementation of the<br>//  _NSArrayCore API (and thus, NSArray the API) for our<br>//  _ContiguousArrayStorage<t>.  We can’t put this implementation<br>//  directly on _ContiguousArrayStorage because generic classes can’t<br>//  override Objective-C selectors.<br>//</t></p>
<h3 id="ContiguousArrayStorageBase:_SwiftNativeNSArrayWithContiguousStorage"><strong>ContiguousArrayStorageBase: </strong>SwiftNativeNSArrayWithContiguousStorage</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Base class of the heap buffer backing arrays.  </span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="doctag">NOTE:</span> older runtimes called this _ContiguousArrayStorageBase. The</span></span><br><span class="line"><span class="comment">/// two must coexist, so it was renamed. The old name must not be used</span></span><br><span class="line"><span class="comment">/// in the new runtime.</span></span><br><span class="line"><span class="comment">// 大部分方法需要子类实现</span></span><br><span class="line">@usableFromInline</span><br><span class="line">@_fixed_layout</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">__ContiguousArrayStorageBase</span>: <span class="title">__SwiftNativeNSArrayWithContiguousStorage</span> </span>&#123; </span><br><span class="line">  @<span class="type">Usablefrominline</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">var</span> countAndCapacity: _ArrayBody</span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="preprocessor">@nonobjc</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(_doNotCallMeBase: ()) &#123;</span><br><span class="line">    _internalInvariantFailure(<span class="string">"creating instance of __ContiguousArrayStorageBase"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">#<span class="keyword">if</span> _runtime(_ObjC)</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">withUnsafeBufferOfObjects</span><span class="generics">&lt;R&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> body: <span class="params">(UnsafeBufferPointer&lt;AnyObject&gt;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; <span class="type">R</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> result = <span class="keyword">try</span> _withVerbatimBridgedUnsafeBuffer(body) &#123;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Can't use a buffer of non-verbatim-bridged elements as an NSArray"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// If the stored type is bridged verbatim, invoke `body` on an</span></span><br><span class="line">  <span class="comment">/// `UnsafeBufferPointer` to the elements and return the result.</span></span><br><span class="line">  <span class="comment">/// Otherwise, return `nil`.</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">_withVerbatimBridgedUnsafeBuffer</span><span class="generics">&lt;R&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> body: <span class="params">(UnsafeBufferPointer&lt;AnyObject&gt;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; <span class="type">R</span>? &#123;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Concrete subclasses must implement _withVerbatimBridgedUnsafeBuffer"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">_getNonVerbatimBridgingBuffer</span><span class="params">()</span></span> -&gt; _BridgingBuffer &#123;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Concrete subclasses must implement _getNonVerbatimBridgingBuffer"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="preprocessor">@objc</span>(mutableCopyWithZone:)</span><br><span class="line">  <span class="keyword">dynamic</span> <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">mutableCopy</span><span class="params">(with <span class="number">_</span>: _SwiftNSZone?)</span></span> -&gt; <span class="type">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = <span class="type">Array</span>&lt;<span class="type">AnyObject</span>&gt;(_ContiguousArrayBuffer(<span class="keyword">self</span>))</span><br><span class="line">    <span class="keyword">return</span> _SwiftNSMutableArray(arr)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="preprocessor">@objc</span>(indexOfObjectIdenticalTo:)</span><br><span class="line">  <span class="keyword">dynamic</span> <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">index</span><span class="params">(ofObjectIdenticalTo object: AnyObject)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = <span class="type">Array</span>&lt;<span class="type">AnyObject</span>&gt;(_ContiguousArrayBuffer(<span class="keyword">self</span>))</span><br><span class="line">    <span class="keyword">return</span> arr.firstIndex &#123; $<span class="number">0</span> === object &#125; ?? <span class="type">NSNotFound</span></span><br><span class="line">  &#125;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">@inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">canStoreElements</span><span class="params">(ofDynamicType <span class="number">_</span>: Any.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Concrete subclasses must implement canStoreElements(ofDynamicType:)"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that every element in the array is.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> staticElementType: <span class="type">Any</span>.<span class="type">Type</span> &#123;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Concrete subclasses must implement staticElementType"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">deinit</span> &#123;</span><br><span class="line">    _internalInvariant(</span><br><span class="line">      <span class="keyword">self</span> !== _emptyArrayStorage, <span class="string">"Deallocating empty array storage?!"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接对内存进行操作</span></span><br><span class="line">@usableFromInline</span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">struct</span> <span class="title">_ContiguousArrayBuffer</span>&lt;<span class="title">Element</span>&gt;: <span class="title">_ArrayBufferProtocol</span> </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _storage: __ContiguousArrayStorageBase</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Make a buffer with uninitialized elements.  After using this</span></span><br><span class="line">  <span class="comment">/// method, you must either initialize the `count` elements at the</span></span><br><span class="line">  <span class="comment">/// result's `.firstElementAddress` or set the result's `.count`</span></span><br><span class="line">  <span class="comment">/// to zero.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(</span><br><span class="line">    _uninitializedCount uninitializedCount: <span class="type">Int</span>,</span><br><span class="line">    minimumCapacity: <span class="type">Int</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">let</span> realMinimumCapacity = <span class="type">Swift</span>.<span class="built_in">max</span>(uninitializedCount, minimumCapacity)</span><br><span class="line">    <span class="keyword">if</span> realMinimumCapacity == <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">self</span> = _ContiguousArrayBuffer&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 初始化一个`_ContiguousArrayStorage&lt;Element&gt;`的实例,</span></span><br><span class="line">      <span class="comment">// 并在后面申请`realMinimumCapacity`大小的连续内存</span></span><br><span class="line">      <span class="comment">// 然后更新StorageHeader</span></span><br><span class="line">      _storage = <span class="type">Builtin</span>.allocWithTailElems_1(</span><br><span class="line">         getContiguousArrayStorageType(<span class="keyword">for</span>: <span class="type">Element</span>.<span class="keyword">self</span>),</span><br><span class="line">         realMinimumCapacity._builtinWordValue, <span class="type">Element</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> storageAddr = <span class="type">UnsafeMutableRawPointer</span>(<span class="type">Builtin</span>.bridgeToRawPointer(_storage))</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> allocSize = _mallocSize(ofAllocation: storageAddr) &#123;</span><br><span class="line">        <span class="keyword">let</span> endAddr = storageAddr + allocSize</span><br><span class="line">        <span class="keyword">let</span> realCapacity = endAddr.assumingMemoryBound(to: <span class="type">Element</span>.<span class="keyword">self</span>) - firstElementAddress</span><br><span class="line">        _initStorageHeader(</span><br><span class="line">          <span class="built_in">count</span>: uninitializedCount, capacity: realCapacity)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _initStorageHeader(</span><br><span class="line">          <span class="built_in">count</span>: uninitializedCount, capacity: realMinimumCapacity)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Initialize the body part of our storage.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Warning: does not initialize elements</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">_initStorageHeader</span><span class="params">(<span class="built_in">count</span>: Int, capacity: Int)</span></span> &#123;</span><br><span class="line">#<span class="keyword">if</span> _runtime(_ObjC)</span><br><span class="line">    <span class="keyword">let</span> verbatim = _isBridgedVerbatimToObjectiveC(<span class="type">Element</span>.<span class="keyword">self</span>)</span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line">    <span class="keyword">let</span> verbatim = <span class="literal">false</span></span><br><span class="line">#endif</span><br><span class="line">    <span class="comment">// 赋值`_storage`中的`countAndCapacity`</span></span><br><span class="line">    <span class="comment">// We can initialize by assignment because _ArrayBody is a trivial type,</span></span><br><span class="line">    <span class="comment">// i.e. contains no references.</span></span><br><span class="line">    _storage.countAndCapacity = _ArrayBody(</span><br><span class="line">      <span class="built_in">count</span>: <span class="built_in">count</span>,</span><br><span class="line">      capacity: capacity,</span><br><span class="line">      elementTypeIsBridgedVerbatim: verbatim)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">@frozen</span><br><span class="line">@usableFromInline</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">struct</span> <span class="title">_ArrayBody</span> </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _storage: _SwiftArrayBodyStorage</span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(</span><br><span class="line">    <span class="built_in">count</span>: <span class="type">Int</span>, capacity: <span class="type">Int</span>, elementTypeIsBridgedVerbatim: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    _internalInvariant(<span class="built_in">count</span> &gt;= <span class="number">0</span>)</span><br><span class="line">    _internalInvariant(capacity &gt;= <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    _storage = _SwiftArrayBodyStorage(</span><br><span class="line">      <span class="built_in">count</span>: <span class="built_in">count</span>,</span><br><span class="line">      _capacityAndFlags:</span><br><span class="line">        (<span class="type">UInt</span>(truncatingIfNeeded: capacity) &amp;&lt;&lt; <span class="number">1</span>) |</span><br><span class="line">        (elementTypeIsBridgedVerbatim ? <span class="number">1</span> : <span class="number">0</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">_SwiftArrayBodyStorage</span> </span>&#123;</span><br><span class="line">  __swift_intptr_t <span class="built_in">count</span>;</span><br><span class="line">  __swift_uintptr_t _capacityAndFlags;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>// Swift Array 转换NSArray O(1)</p>
<h3 id="SwiftNativeNSArrayWithContiguousStorage_:_SwiftNativeNSArray_(NSArray)"><strong>SwiftNativeNSArrayWithContiguousStorage : </strong>SwiftNativeNSArray (NSArray)</h3><h3 id="__SwiftNativeNSArrayWithContiguousStorage_(non-objc)">__SwiftNativeNSArrayWithContiguousStorage (non-objc)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// An `NSArray` with Swift-native reference counting and contiguous</span></span><br><span class="line"><span class="comment">/// storage.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="doctag">NOTE:</span> older runtimes called this</span></span><br><span class="line"><span class="comment">/// _SwiftNativeNSArrayWithContiguousStorage. The two must coexist, so</span></span><br><span class="line"><span class="comment">/// it was renamed. The old name must not be used in the new runtime.</span></span><br><span class="line">@_fixed_layout</span><br><span class="line">@usableFromInline</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">__SwiftNativeNSArrayWithContiguousStorage</span></span><br><span class="line">  : <span class="title">__SwiftNativeNSArray</span> </span>&#123; <span class="comment">// Provides NSArray inheritance and native refcounting</span></span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="preprocessor">@nonobjc</span> <span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">init</span>() &#123; <span class="keyword">super</span>.<span class="keyword">init</span>() &#125;</span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">deinit</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Operate on our contiguous storage</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="func"><span class="keyword">func</span> <span class="title">withUnsafeBufferOfObjects</span><span class="generics">&lt;R&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> body: <span class="params">(UnsafeBufferPointer&lt;AnyObject&gt;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; <span class="type">R</span> &#123;</span><br><span class="line">    _internalInvariantFailure(</span><br><span class="line">      <span class="string">"Must override withUnsafeBufferOfObjects in derived classes"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@_fixed_layout</span><br><span class="line">@usableFromInline</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">__SwiftNativeNSArray</span> </span>&#123;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">deinit</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Empty shim version for non-objc platforms.</span></span><br><span class="line">@usableFromInline</span><br><span class="line">@_fixed_layout</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">__SwiftNativeNSArrayWithContiguousStorage</span> </span>&#123;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">deinit</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="__SwiftNativeNSArray">__SwiftNativeNSArray</h3><p>provides NSArray inheritance and native refcounting</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@_fixed_layout</span><br><span class="line">@usableFromInline</span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">__SwiftNativeNSArray</span> </span>&#123;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">deinit</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Functions">Functions</h2><h3 id="Copy_on_Write">Copy on Write</h3><p>以 <code>append</code> 为例:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Adds a new element at the end of the array.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Use this method to append a single element to the end of a mutable array.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     var numbers = [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">///     numbers.append(100)</span></span><br><span class="line"><span class="comment">///     print(numbers)</span></span><br><span class="line"><span class="comment">///     // Prints "[1, 2, 3, 4, 5, 100]"</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Because arrays increase their allocated capacity using an exponential</span></span><br><span class="line"><span class="comment">/// strategy, appending a single element to an array is an O(1) operation</span></span><br><span class="line"><span class="comment">/// when averaged over many calls to the `append(_:)` method. When an array</span></span><br><span class="line"><span class="comment">/// has additional capacity and is not sharing its storage with another</span></span><br><span class="line"><span class="comment">/// instance, appending an element is O(1). When an array needs to</span></span><br><span class="line"><span class="comment">/// reallocate storage before appending or its storage is shared with</span></span><br><span class="line"><span class="comment">/// another copy, appending is O(*n*), where *n* is the length of the array.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter newElement: The element to append to the array.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Complexity: O(1) on average, over many calls to `append(_:)` on the</span></span><br><span class="line"><span class="comment">///   same array.</span></span><br><span class="line">@inlinable</span><br><span class="line">@_semantics(<span class="string">"array.append_element"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">append</span><span class="params">(<span class="number">_</span> newElement: __owned Element)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Separating uniqueness check and capacity check allows hoisting the</span></span><br><span class="line">  <span class="comment">// uniqueness check out of a loop.</span></span><br><span class="line">  _makeUniqueAndReserveCapacityIfNotUnique()</span><br><span class="line">  <span class="keyword">let</span> oldCount = _buffer.mutableCount</span><br><span class="line">  _reserveCapacityAssumingUniqueBuffer(oldCount: oldCount)</span><br><span class="line">  _appendElementAssumeUniqueAndCapacity(oldCount, newElement: newElement)</span><br><span class="line">  _endMutation()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@inlinable</span><br><span class="line">@_semantics(<span class="string">"array.make_mutable"</span>)</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">_makeUniqueAndReserveCapacityIfNotUnique</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> _slowPath(!_buffer.beginCOWMutation()) &#123;</span><br><span class="line">    _createNewBuffer(bufferIsUnique: <span class="literal">false</span>,</span><br><span class="line">                     minimumCapacity: <span class="built_in">count</span> &amp;+ <span class="number">1</span>,</span><br><span class="line">                     growForAppend: <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Creates a new buffer, replacing the current buffer.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// If `bufferIsUnique` is true, the buffer is assumed to be uniquely</span></span><br><span class="line"><span class="comment">/// referenced by this array and the elements are moved - instead of copied -</span></span><br><span class="line"><span class="comment">/// to the new buffer.</span></span><br><span class="line"><span class="comment">/// The `minimumCapacity` is the lower bound for the new capacity.</span></span><br><span class="line"><span class="comment">/// If `growForAppend` is true, the new capacity is calculated using</span></span><br><span class="line"><span class="comment">/// `_growArrayCapacity`.</span></span><br><span class="line">@_alwaysEmitIntoClient</span><br><span class="line">@inline(never)</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">_createNewBuffer</span><span class="params">(</span><br><span class="line">  bufferIsUnique: Bool, minimumCapacity: Int, growForAppend: Bool</span><br><span class="line">)</span></span> &#123;</span><br><span class="line">  _internalInvariant(!bufferIsUnique || _buffer.<span class="built_in">isUniquelyReferenced</span>())</span><br><span class="line">  _buffer = _buffer._consumeAndCreateNew(bufferIsUnique: bufferIsUnique,</span><br><span class="line">                                         minimumCapacity: minimumCapacity,</span><br><span class="line">                                         growForAppend: growForAppend)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Creates and returns a new uniquely referenced buffer which is a copy of</span></span><br><span class="line"><span class="comment">/// this buffer.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// If `bufferIsUnique` is true, the buffer is assumed to be uniquely</span></span><br><span class="line"><span class="comment">/// referenced and the elements are moved - instead of copied - to the new</span></span><br><span class="line"><span class="comment">/// buffer.</span></span><br><span class="line"><span class="comment">/// The `minimumCapacity` is the lower bound for the new capacity.</span></span><br><span class="line"><span class="comment">/// If `growForAppend` is true, the new capacity is calculated using</span></span><br><span class="line"><span class="comment">/// `_growArrayCapacity`, but at least kept at `minimumCapacity`.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// This buffer is consumed, i.e. it's released.</span></span><br><span class="line">@_alwaysEmitIntoClient</span><br><span class="line">@inline(never)</span><br><span class="line">@_semantics(<span class="string">"optimize.sil.specialize.owned2guarantee.never"</span>)</span><br><span class="line"><span class="keyword">internal</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">_consumeAndCreateNew</span><span class="params">(</span><br><span class="line">  bufferIsUnique: Bool, minimumCapacity: Int, growForAppend: Bool</span><br><span class="line">)</span></span> -&gt; _ArrayBuffer &#123;</span><br><span class="line">  <span class="keyword">let</span> newCapacity = _growArrayCapacity(oldCapacity: capacity,</span><br><span class="line">                                       minimumCapacity: minimumCapacity,</span><br><span class="line">                                       growForAppend: growForAppend)</span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">c</span> = <span class="built_in">count</span></span><br><span class="line">  _internalInvariant(newCapacity &gt;= <span class="built_in">c</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> newBuffer = _ContiguousArrayBuffer&lt;<span class="type">Element</span>&gt;(</span><br><span class="line">    _uninitializedCount: <span class="built_in">c</span>, minimumCapacity: newCapacity)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// 当buffer is Unique, 直接不进行copy，操作数据</span></span><br><span class="line">  <span class="keyword">if</span> bufferIsUnique &#123;</span><br><span class="line">    <span class="comment">// As an optimization, if the original buffer is unique, we can just move</span></span><br><span class="line">    <span class="comment">// the elements instead of copying.</span></span><br><span class="line">    <span class="keyword">let</span> dest = newBuffer.firstElementAddress</span><br><span class="line">    dest.moveInitialize(from: mutableFirstElementAddress,</span><br><span class="line">                        <span class="built_in">count</span>: <span class="built_in">c</span>)</span><br><span class="line">    _native.mutableCount = <span class="number">0</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/// 进行复制</span></span><br><span class="line">    _copyContents(</span><br><span class="line">      subRange: <span class="number">0</span>..&lt;<span class="built_in">c</span>,</span><br><span class="line">      initializing: newBuffer.mutableFirstElementAddress)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _ArrayBuffer(_buffer: newBuffer, shiftedToStartIndex: <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/05/13/Swift-Source-Code-ContiguousArray/" data-id="cl3sosys6001tt0z66lpfknik" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift-source-code/">swift source code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Swift-Source-Code-Collection" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/11/Swift-Source-Code-Collection/" class="article-date">
  <time datetime="2022-05-11T11:27:18.000Z" itemprop="datePublished">2022-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/11/Swift-Source-Code-Collection/">Swift Source Code: Collection</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Summary">Summary</h1><p>Collection extends Sequence. It guarantees that the sequence is multi-pass, and it allows you to look up elements by their indices. It also adds slicing capabilities via its SubSequence type, which is a collection itself.</p>
<h1 id="Types">Types</h1><h2 id="IndexingIterator">IndexingIterator</h2><ul>
<li><code>IndexingIterator</code> 是collection类型默认的iterator实现</li>
<li>自定义Collection所需要的最小实现只需要startIndex, endIndex, subscript方法</li>
<li><code>IndexingIterator</code>实现了<code>IteratorProtocol</code>, <code>Sequence</code>, <code>Sendable</code>等protocol</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A type that iterates over a collection using its indices.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The `IndexingIterator` type is the default iterator for any collection that</span></span><br><span class="line"><span class="comment">/// doesn't declare its own. It acts as an iterator by using a collection's</span></span><br><span class="line"><span class="comment">/// indices to step over each value in the collection. Most collections in the</span></span><br><span class="line"><span class="comment">/// standard library use `IndexingIterator` as their iterator.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// By default, any custom collection type you create will inherit a</span></span><br><span class="line"><span class="comment">/// `makeIterator()` method that returns an `IndexingIterator` instance,</span></span><br><span class="line"><span class="comment">/// making it unnecessary to declare your own. When creating a custom</span></span><br><span class="line"><span class="comment">/// collection type, add the minimal requirements of the `Collection`</span></span><br><span class="line"><span class="comment">/// protocol: starting and ending indices and a subscript for accessing</span></span><br><span class="line"><span class="comment">/// elements. With those elements defined, the inherited `makeIterator()`</span></span><br><span class="line"><span class="comment">/// method satisfies the requirements of the `Sequence` protocol.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Here's an example of a type that declares the minimal requirements for a</span></span><br><span class="line"><span class="comment">/// collection. The `CollectionOfTwo` structure is a fixed-size collection</span></span><br><span class="line"><span class="comment">/// that always holds two elements of a specific type.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     struct CollectionOfTwo&lt;Element&gt;: Collection &#123;</span></span><br><span class="line"><span class="comment">///         let elements: (Element, Element)</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///         init(_ first: Element, _ second: Element) &#123;</span></span><br><span class="line"><span class="comment">///             self.elements = (first, second)</span></span><br><span class="line"><span class="comment">///         &#125;</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///         var startIndex: Int &#123; return 0 &#125;</span></span><br><span class="line"><span class="comment">///         var endIndex: Int   &#123; return 2 &#125;</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///         subscript(index: Int) -&gt; Element &#123;</span></span><br><span class="line"><span class="comment">///             switch index &#123;</span></span><br><span class="line"><span class="comment">///             case 0: return elements.0</span></span><br><span class="line"><span class="comment">///             case 1: return elements.1</span></span><br><span class="line"><span class="comment">///             default: fatalError("Index out of bounds.")</span></span><br><span class="line"><span class="comment">///             &#125;</span></span><br><span class="line"><span class="comment">///         &#125;</span></span><br><span class="line"><span class="comment">///         </span></span><br><span class="line"><span class="comment">///         func index(after i: Int) -&gt; Int &#123;</span></span><br><span class="line"><span class="comment">///             precondition(i &lt; endIndex, "Can't advance beyond endIndex")</span></span><br><span class="line"><span class="comment">///             return i + 1</span></span><br><span class="line"><span class="comment">///         &#125;</span></span><br><span class="line"><span class="comment">///     &#125;</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Because `CollectionOfTwo` doesn't define its own `makeIterator()`</span></span><br><span class="line"><span class="comment">/// method or `Iterator` associated type, it uses the default iterator type,</span></span><br><span class="line"><span class="comment">/// `IndexingIterator`. This example shows how a `CollectionOfTwo` instance</span></span><br><span class="line"><span class="comment">/// can be created holding the values of a point, and then iterated over</span></span><br><span class="line"><span class="comment">/// using a `for`-`in` loop.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let point = CollectionOfTwo(15.0, 20.0)</span></span><br><span class="line"><span class="comment">///     for element in point &#123;</span></span><br><span class="line"><span class="comment">///         print(element)</span></span><br><span class="line"><span class="comment">///     &#125;</span></span><br><span class="line"><span class="comment">///     // Prints "15.0"</span></span><br><span class="line"><span class="comment">///     // Prints "20.0"</span></span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">IndexingIterator</span>&lt;<span class="title">Elements</span>: <span class="title">Collection</span>&gt; </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> _elements: <span class="type">Elements</span></span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _position: <span class="type">Elements</span>.<span class="type">Index</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Creates an iterator over the given collection.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  @inline(__always)</span><br><span class="line">  <span class="keyword">public</span> <span class="comment">/// @testable</span></span><br><span class="line">  <span class="keyword">init</span>(_elements: <span class="type">Elements</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>._elements = _elements</span><br><span class="line">    <span class="keyword">self</span>._position = _elements.startIndex</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Creates an iterator over the given collection.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  @inline(__always)</span><br><span class="line">  <span class="keyword">public</span> <span class="comment">/// @testable</span></span><br><span class="line">  <span class="keyword">init</span>(_elements: <span class="type">Elements</span>, _position: <span class="type">Elements</span>.<span class="type">Index</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>._elements = _elements</span><br><span class="line">    <span class="keyword">self</span>._position = _position</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">IndexingIterator</span>: <span class="title">IteratorProtocol</span>, <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Element</span> = <span class="type">Elements</span>.<span class="type">Element</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Iterator</span> = <span class="type">IndexingIterator</span>&lt;<span class="type">Elements</span>&gt;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">SubSequence</span> = <span class="type">AnySequence</span>&lt;<span class="type">Element</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Advances to the next element and returns it, or `nil` if no next element</span></span><br><span class="line">  <span class="comment">/// exists.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Repeatedly calling this method returns all the elements of the underlying</span></span><br><span class="line">  <span class="comment">/// sequence in order. As soon as the sequence has run out of elements, all</span></span><br><span class="line">  <span class="comment">/// subsequent calls return `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// This example shows how an iterator can be used explicitly to emulate a</span></span><br><span class="line">  <span class="comment">/// `for`-`in` loop. First, retrieve a sequence's iterator, and then call</span></span><br><span class="line">  <span class="comment">/// the iterator's `next()` method until it returns `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let numbers = [2, 3, 5, 7]</span></span><br><span class="line">  <span class="comment">///     var numbersIterator = numbers.makeIterator()</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     while let num = numbersIterator.next() &#123;</span></span><br><span class="line">  <span class="comment">///         print(num)</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // Prints "2"</span></span><br><span class="line">  <span class="comment">///     // Prints "3"</span></span><br><span class="line">  <span class="comment">///     // Prints "5"</span></span><br><span class="line">  <span class="comment">///     // Prints "7"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: The next element in the underlying sequence if a next element</span></span><br><span class="line">  <span class="comment">///   exists; otherwise, `nil`.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  @inline(__always)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Elements</span>.<span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> _position == _elements.endIndex &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> element = _elements[_position]</span><br><span class="line">    _elements.formIndex(after: &amp;_position)</span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">IndexingIterator</span>: <span class="title">Sendable</span></span><br><span class="line">  <span class="title">where</span> <span class="title">Elements</span>: <span class="title">Sendable</span>, <span class="title">Elements</span>.<span class="title">Index</span>: <span class="title">Sendable</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Collection">Collection</h2><p>A sequence whose elements can be traversed multiple times, nondestructively, and accessed by an indexed subscript.</p>
<ul>
<li>Accessing Individual Elements</li>
<li>Accessing Slices of a Collection</li>
<li>Traversing a Collection</li>
<li>Conforming to the Collection Protocol<ul>
<li>The <code>startIndex</code> and <code>endIndex</code> properties</li>
<li>A subscript</li>
<li><code>index(after:)</code></li>
</ul>
</li>
<li>Expected Performance<ul>
<li><code>startIndex</code> and <code>endIndex</code> and subscript access O(1)</li>
<li>forward or bidirectional collection accessing its <code>count</code> property is an O(n)</li>
</ul>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Collection</span>: <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> ideally this would be in MigrationSupport.swift, but it needs</span></span><br><span class="line">  <span class="comment">// to be on the protocol instead of as an extension</span></span><br><span class="line">  <span class="preprocessor">@available</span>(*, deprecated<span class="comment">/*, obsoleted: 5.0*/</span>, message: <span class="string">"all index distances are now of type Int"</span>)</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">IndexDistance</span> = <span class="type">Int</span>  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> Associated type inference requires this.</span></span><br><span class="line">  <span class="keyword">override</span> associatedtype <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> &lt;rdar://problem/34142121&gt;</span></span><br><span class="line">  <span class="comment">// This typealias should be removed as it predates the source compatibility</span></span><br><span class="line">  <span class="comment">// guarantees of Swift 3, but it cannot due to a bug.</span></span><br><span class="line">  <span class="preprocessor">@available</span>(swift, deprecated: <span class="number">3.2</span>, obsoleted: <span class="number">5.0</span>, renamed: <span class="string">"Element"</span>)</span><br><span class="line">  <span class="keyword">typealias</span> _Element = <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that represents a position in the collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Valid indices consist of the position of every element and a</span></span><br><span class="line">  <span class="comment">/// "past the end" position that's not valid for use as a subscript</span></span><br><span class="line">  <span class="comment">/// argument.</span></span><br><span class="line">  associatedtype <span class="type">Index</span>: <span class="type">Comparable</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// The position of the first element in a nonempty collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// If the collection is empty, `startIndex` is equal to `endIndex`.</span></span><br><span class="line">  <span class="keyword">var</span> startIndex: <span class="type">Index</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/// The collection's "past the end" position---that is, the position one</span></span><br><span class="line">  <span class="comment">/// greater than the last valid subscript argument.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// When you need a range that includes the last element of a collection, use</span></span><br><span class="line">  <span class="comment">/// the half-open range operator (`..&lt;`) with `endIndex`. The `..&lt;` operator</span></span><br><span class="line">  <span class="comment">/// creates a range that doesn't include the upper bound, so it's always</span></span><br><span class="line">  <span class="comment">/// safe to use with `endIndex`. For example:</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let numbers = [10, 20, 30, 40, 50]</span></span><br><span class="line">  <span class="comment">///     if let index = numbers.firstIndex(of: 30) &#123;</span></span><br><span class="line">  <span class="comment">///         print(numbers[index ..&lt; numbers.endIndex])</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // Prints "[30, 40, 50]"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// If the collection is empty, `endIndex` is equal to `startIndex`.</span></span><br><span class="line">  <span class="keyword">var</span> endIndex: <span class="type">Index</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that provides the collection's iteration interface and</span></span><br><span class="line">  <span class="comment">/// encapsulates its iteration state.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// By default, a collection conforms to the `Sequence` protocol by</span></span><br><span class="line">  <span class="comment">/// supplying `IndexingIterator` as its associated `Iterator`</span></span><br><span class="line">  <span class="comment">/// type.</span></span><br><span class="line">  associatedtype <span class="type">Iterator</span> = <span class="type">IndexingIterator</span>&lt;<span class="type">Self</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> Only needed for associated type inference. Otherwise,</span></span><br><span class="line">  <span class="comment">// we get an `IndexingIterator` rather than properly deducing the</span></span><br><span class="line">  <span class="comment">// Iterator type from makeIterator(). &lt;rdar://problem/21539115&gt;</span></span><br><span class="line">  <span class="comment">/// Returns an iterator over the elements of the collection.</span></span><br><span class="line">  <span class="keyword">override</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A collection representing a contiguous subrange of this collection's</span></span><br><span class="line">  <span class="comment">/// elements. The subsequence shares indices with the original collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The default subsequence type for collections that don't define their own</span></span><br><span class="line">  <span class="comment">/// is `Slice`.</span></span><br><span class="line">  associatedtype <span class="type">SubSequence</span>: <span class="type">Collection</span> = <span class="type">Slice</span>&lt;<span class="type">Self</span>&gt;</span><br><span class="line">  <span class="keyword">where</span> <span class="type">SubSequence</span>.<span class="type">Index</span> == <span class="type">Index</span>,</span><br><span class="line">        <span class="type">Element</span> == <span class="type">SubSequence</span>.<span class="type">Element</span>,</span><br><span class="line">        <span class="type">SubSequence</span>.<span class="type">SubSequence</span> == <span class="type">SubSequence</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Accesses the element at the specified position.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The following example accesses an element of an array through its</span></span><br><span class="line">  <span class="comment">/// subscript to print its value:</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     var streets = ["Adams", "Bryant", "Channing", "Douglas", "Evarts"]</span></span><br><span class="line">  <span class="comment">///     print(streets[1])</span></span><br><span class="line">  <span class="comment">///     // Prints "Bryant"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// You can subscript a collection with any valid index other than the</span></span><br><span class="line">  <span class="comment">/// collection's end index. The end index refers to the position one past</span></span><br><span class="line">  <span class="comment">/// the last element of a collection, so it doesn't correspond with an</span></span><br><span class="line">  <span class="comment">/// element.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter position: The position of the element to access. `position`</span></span><br><span class="line">  <span class="comment">///   must be a valid index of the collection that is not equal to the</span></span><br><span class="line">  <span class="comment">///   `endIndex` property.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1)</span></span><br><span class="line">  @_borrowed</span><br><span class="line">  <span class="keyword">subscript</span>(position: <span class="type">Index</span>) -&gt; <span class="type">Element</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Accesses a contiguous subrange of the collection's elements.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// For example, using a `PartialRangeFrom` range expression with an array</span></span><br><span class="line">  <span class="comment">/// accesses the subrange from the start of the range expression until the</span></span><br><span class="line">  <span class="comment">/// end of the array.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let streets = ["Adams", "Bryant", "Channing", "Douglas", "Evarts"]</span></span><br><span class="line">  <span class="comment">///     let streetsSlice = streets[2..&lt;5]</span></span><br><span class="line">  <span class="comment">///     print(streetsSlice)</span></span><br><span class="line">  <span class="comment">///     // ["Channing", "Douglas", "Evarts"]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The accessed slice uses the same indices for the same elements as the</span></span><br><span class="line">  <span class="comment">/// original collection. This example searches `streetsSlice` for one of the</span></span><br><span class="line">  <span class="comment">/// strings in the slice, and then uses that index in the original array.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let index = streetsSlice.firstIndex(of: "Evarts")!    // 4</span></span><br><span class="line">  <span class="comment">///     print(streets[index])</span></span><br><span class="line">  <span class="comment">///     // "Evarts"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Always use the slice's `startIndex` property instead of assuming that its</span></span><br><span class="line">  <span class="comment">/// indices start at a particular value. Attempting to access an element by</span></span><br><span class="line">  <span class="comment">/// using an index outside the bounds of the slice may result in a runtime</span></span><br><span class="line">  <span class="comment">/// error, even if that index is valid for the original collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     print(streetsSlice.startIndex)</span></span><br><span class="line">  <span class="comment">///     // 2</span></span><br><span class="line">  <span class="comment">///     print(streetsSlice[2])</span></span><br><span class="line">  <span class="comment">///     // "Channing"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     print(streetsSlice[0])</span></span><br><span class="line">  <span class="comment">///     // error: Index out of bounds</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter bounds: A range of the collection's indices. The bounds of</span></span><br><span class="line">  <span class="comment">///   the range must be valid indices of the collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1)</span></span><br><span class="line">  <span class="keyword">subscript</span>(bounds: <span class="type">Range</span>&lt;<span class="type">Index</span>&gt;) -&gt; <span class="type">SubSequence</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that represents the indices that are valid for subscripting the</span></span><br><span class="line">  <span class="comment">/// collection, in ascending order.</span></span><br><span class="line">  associatedtype <span class="type">Indices</span>: <span class="type">Collection</span> = <span class="type">DefaultIndices</span>&lt;<span class="type">Self</span>&gt;</span><br><span class="line">    <span class="keyword">where</span> <span class="type">Indices</span>.<span class="type">Element</span> == <span class="type">Index</span>, </span><br><span class="line">          <span class="type">Indices</span>.<span class="type">Index</span> == <span class="type">Index</span>,</span><br><span class="line">          <span class="type">Indices</span>.<span class="type">SubSequence</span> == <span class="type">Indices</span></span><br><span class="line">        </span><br><span class="line">  <span class="comment">/// The indices that are valid for subscripting the collection, in ascending</span></span><br><span class="line">  <span class="comment">/// order.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// A collection's `indices` property can hold a strong reference to the</span></span><br><span class="line">  <span class="comment">/// collection itself, causing the collection to be nonuniquely referenced.</span></span><br><span class="line">  <span class="comment">/// If you mutate the collection while iterating over its indices, a strong</span></span><br><span class="line">  <span class="comment">/// reference can result in an unexpected copy of the collection. To avoid</span></span><br><span class="line">  <span class="comment">/// the unexpected copy, use the `index(after:)` method starting with</span></span><br><span class="line">  <span class="comment">/// `startIndex` to produce indices instead.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     var c = MyFancyCollection([10, 20, 30, 40, 50])</span></span><br><span class="line">  <span class="comment">///     var i = c.startIndex</span></span><br><span class="line">  <span class="comment">///     while i != c.endIndex &#123;</span></span><br><span class="line">  <span class="comment">///         c[i] /= 5</span></span><br><span class="line">  <span class="comment">///         i = c.index(after: i)</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // c == MyFancyCollection([2, 4, 6, 8, 10])</span></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">indices</span>: <span class="type">Indices</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A Boolean value indicating whether the collection is empty.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// When you need to check whether your collection is empty, use the</span></span><br><span class="line">  <span class="comment">/// `isEmpty` property instead of checking that the `count` property is</span></span><br><span class="line">  <span class="comment">/// equal to zero. For collections that don't conform to</span></span><br><span class="line">  <span class="comment">/// `RandomAccessCollection`, accessing the `count` property iterates</span></span><br><span class="line">  <span class="comment">/// through the elements of the collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let horseName = "Silver"</span></span><br><span class="line">  <span class="comment">///     if horseName.isEmpty &#123;</span></span><br><span class="line">  <span class="comment">///         print("My horse has no name.")</span></span><br><span class="line">  <span class="comment">///     &#125; else &#123;</span></span><br><span class="line">  <span class="comment">///         print("Hi ho, \(horseName)!")</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // Prints "Hi ho, Silver!"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1)</span></span><br><span class="line">  <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// The number of elements in the collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// To check whether a collection is empty, use its `isEmpty` property</span></span><br><span class="line">  <span class="comment">/// instead of comparing `count` to zero. Unless the collection guarantees</span></span><br><span class="line">  <span class="comment">/// random-access performance, calculating `count` can be an O(*n*)</span></span><br><span class="line">  <span class="comment">/// operation.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1) if the collection conforms to</span></span><br><span class="line">  <span class="comment">///   `RandomAccessCollection`; otherwise, O(*n*), where *n* is the length</span></span><br><span class="line">  <span class="comment">///   of the collection.</span></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// The following requirements enable dispatching for firstIndex(of:) and</span></span><br><span class="line">  <span class="comment">// lastIndex(of:) when the element type is Equatable.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns `Optional(Optional(index))` if an element was found</span></span><br><span class="line">  <span class="comment">/// or `Optional(nil)` if an element was determined to be missing;</span></span><br><span class="line">  <span class="comment">/// otherwise, `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(*n*), where *n* is the length of the collection.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_customIndexOfEquatableElement</span><span class="params">(<span class="number">_</span> element: Element)</span></span> -&gt; <span class="type">Index</span>??</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Customization point for `Collection.lastIndex(of:)`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Define this method if the collection can find an element in less than</span></span><br><span class="line">  <span class="comment">/// O(*n*) by exploiting collection-specific knowledge.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: `nil` if a linear search should be attempted instead,</span></span><br><span class="line">  <span class="comment">///   `Optional(nil)` if the element was not found, or</span></span><br><span class="line">  <span class="comment">///   `Optional(Optional(index))` if an element was found.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: Hopefully less than O(`count`).</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_customLastIndexOfEquatableElement</span><span class="params">(<span class="number">_</span> element: Element)</span></span> -&gt; <span class="type">Index</span>??</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns an index that is the specified distance from the given index.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The following example obtains an index advanced four positions from a</span></span><br><span class="line">  <span class="comment">/// string's starting index and then prints the character at that position.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let s = "Swift"</span></span><br><span class="line">  <span class="comment">///     let i = s.index(s.startIndex, offsetBy: 4)</span></span><br><span class="line">  <span class="comment">///     print(s[i])</span></span><br><span class="line">  <span class="comment">///     // Prints "t"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The value passed as `distance` must not offset `i` beyond the bounds of</span></span><br><span class="line">  <span class="comment">/// the collection.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - i: A valid index of the collection.</span></span><br><span class="line">  <span class="comment">///   - distance: The distance to offset `i`. `distance` must not be negative</span></span><br><span class="line">  <span class="comment">///     unless the collection conforms to the `BidirectionalCollection`</span></span><br><span class="line">  <span class="comment">///     protocol.</span></span><br><span class="line">  <span class="comment">/// - Returns: An index offset by `distance` from the index `i`. If</span></span><br><span class="line">  <span class="comment">///   `distance` is positive, this is the same value as the result of</span></span><br><span class="line">  <span class="comment">///   `distance` calls to `index(after:)`. If `distance` is negative, this</span></span><br><span class="line">  <span class="comment">///   is the same value as the result of `abs(distance)` calls to</span></span><br><span class="line">  <span class="comment">///   `index(before:)`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1) if the collection conforms to</span></span><br><span class="line">  <span class="comment">///   `RandomAccessCollection`; otherwise, O(*k*), where *k* is the absolute</span></span><br><span class="line">  <span class="comment">///   value of `distance`.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">index</span><span class="params">(<span class="number">_</span> i: Index, offsetBy <span class="built_in">distance</span>: Int)</span></span> -&gt; <span class="type">Index</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns an index that is the specified distance from the given index,</span></span><br><span class="line">  <span class="comment">/// unless that distance is beyond a given limiting index.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The following example obtains an index advanced four positions from a</span></span><br><span class="line">  <span class="comment">/// string's starting index and then prints the character at that position.</span></span><br><span class="line">  <span class="comment">/// The operation doesn't require going beyond the limiting `s.endIndex`</span></span><br><span class="line">  <span class="comment">/// value, so it succeeds.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let s = "Swift"</span></span><br><span class="line">  <span class="comment">///     if let i = s.index(s.startIndex, offsetBy: 4, limitedBy: s.endIndex) &#123;</span></span><br><span class="line">  <span class="comment">///         print(s[i])</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // Prints "t"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The next example attempts to retrieve an index six positions from</span></span><br><span class="line">  <span class="comment">/// `s.startIndex` but fails, because that distance is beyond the index</span></span><br><span class="line">  <span class="comment">/// passed as `limit`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let j = s.index(s.startIndex, offsetBy: 6, limitedBy: s.endIndex)</span></span><br><span class="line">  <span class="comment">///     print(j)</span></span><br><span class="line">  <span class="comment">///     // Prints "nil"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The value passed as `distance` must not offset `i` beyond the bounds of</span></span><br><span class="line">  <span class="comment">/// the collection, unless the index passed as `limit` prevents offsetting</span></span><br><span class="line">  <span class="comment">/// beyond those bounds.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - i: A valid index of the collection.</span></span><br><span class="line">  <span class="comment">///   - distance: The distance to offset `i`. `distance` must not be negative</span></span><br><span class="line">  <span class="comment">///     unless the collection conforms to the `BidirectionalCollection`</span></span><br><span class="line">  <span class="comment">///     protocol.</span></span><br><span class="line">  <span class="comment">///   - limit: A valid index of the collection to use as a limit. If</span></span><br><span class="line">  <span class="comment">///     `distance &gt; 0`, a limit that is less than `i` has no effect.</span></span><br><span class="line">  <span class="comment">///     Likewise, if `distance &lt; 0`, a limit that is greater than `i` has no</span></span><br><span class="line">  <span class="comment">///     effect.</span></span><br><span class="line">  <span class="comment">/// - Returns: An index offset by `distance` from the index `i`, unless that</span></span><br><span class="line">  <span class="comment">///   index would be beyond `limit` in the direction of movement. In that</span></span><br><span class="line">  <span class="comment">///   case, the method returns `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1) if the collection conforms to</span></span><br><span class="line">  <span class="comment">///   `RandomAccessCollection`; otherwise, O(*k*), where *k* is the absolute</span></span><br><span class="line">  <span class="comment">///   value of `distance`.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">index</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> i: Index, offsetBy <span class="built_in">distance</span>: Int, limitedBy limit: Index</span><br><span class="line">  )</span></span> -&gt; <span class="type">Index</span>?</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns the distance between two indices.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Unless the collection conforms to the `BidirectionalCollection` protocol,</span></span><br><span class="line">  <span class="comment">/// `start` must be less than or equal to `end`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - start: A valid index of the collection.</span></span><br><span class="line">  <span class="comment">///   - end: Another valid index of the collection. If `end` is equal to</span></span><br><span class="line">  <span class="comment">///     `start`, the result is zero.</span></span><br><span class="line">  <span class="comment">/// - Returns: The distance between `start` and `end`. The result can be</span></span><br><span class="line">  <span class="comment">///   negative only if the collection conforms to the</span></span><br><span class="line">  <span class="comment">///   `BidirectionalCollection` protocol.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1) if the collection conforms to</span></span><br><span class="line">  <span class="comment">///   `RandomAccessCollection`; otherwise, O(*k*), where *k* is the</span></span><br><span class="line">  <span class="comment">///   resulting distance.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">distance</span><span class="params">(from start: Index, to end: Index)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Performs a range check in O(1), or a no-op when a range check is not</span></span><br><span class="line">  <span class="comment">/// implementable in O(1).</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The range check, if performed, is equivalent to:</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     precondition(bounds.contains(index))</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Use this function to perform a cheap range check for QoI purposes when</span></span><br><span class="line">  <span class="comment">/// memory safety is not a concern.  Do not rely on this range check for</span></span><br><span class="line">  <span class="comment">/// memory safety.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The default implementation for forward and bidirectional indices is a</span></span><br><span class="line">  <span class="comment">/// no-op.  The default implementation for random access indices performs a</span></span><br><span class="line">  <span class="comment">/// range check.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1).</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_failEarlyRangeCheck</span><span class="params">(<span class="number">_</span> index: Index, bounds: Range&lt;Index&gt;)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_failEarlyRangeCheck</span><span class="params">(<span class="number">_</span> index: Index, bounds: ClosedRange&lt;Index&gt;)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Performs a range check in O(1), or a no-op when a range check is not</span></span><br><span class="line">  <span class="comment">/// implementable in O(1).</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The range check, if performed, is equivalent to:</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     precondition(</span></span><br><span class="line">  <span class="comment">///       bounds.contains(range.lowerBound) ||</span></span><br><span class="line">  <span class="comment">///       range.lowerBound == bounds.upperBound)</span></span><br><span class="line">  <span class="comment">///     precondition(</span></span><br><span class="line">  <span class="comment">///       bounds.contains(range.upperBound) ||</span></span><br><span class="line">  <span class="comment">///       range.upperBound == bounds.upperBound)</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Use this function to perform a cheap range check for QoI purposes when</span></span><br><span class="line">  <span class="comment">/// memory safety is not a concern.  Do not rely on this range check for</span></span><br><span class="line">  <span class="comment">/// memory safety.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The default implementation for forward and bidirectional indices is a</span></span><br><span class="line">  <span class="comment">/// no-op.  The default implementation for random access indices performs a</span></span><br><span class="line">  <span class="comment">/// range check.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1).</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_failEarlyRangeCheck</span><span class="params">(<span class="number">_</span> range: Range&lt;Index&gt;, bounds: Range&lt;Index&gt;)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns the position immediately after the given index.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The successor of an index must be well defined. For an index `i` into a</span></span><br><span class="line">  <span class="comment">/// collection `c`, calling `c.index(after: i)` returns the same index every</span></span><br><span class="line">  <span class="comment">/// time.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter i: A valid index of the collection. `i` must be less than</span></span><br><span class="line">  <span class="comment">///   `endIndex`.</span></span><br><span class="line">  <span class="comment">/// - Returns: The index value immediately after `i`.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">index</span><span class="params">(after i: Index)</span></span> -&gt; <span class="type">Index</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Replaces the given index with its successor.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter i: A valid index of the collection. `i` must be less than</span></span><br><span class="line">  <span class="comment">///   `endIndex`.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">formIndex</span><span class="params">(after i: <span class="keyword">inout</span> Index)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Functions">Functions</h1><h2 id="randomeElement">randomeElement</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/// 这两个方法我觉得可以用在测试代码中，如可以方便的随机选取登陆用户账号密码用于测试，或者随机一个dataset传入要测试的方法中</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">randomElement</span><span class="generics">&lt;T: RandomNumberGenerator&gt;</span><span class="params">(</span><br><span class="line">    using generator: <span class="keyword">inout</span> T</span><br><span class="line">  )</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">guard</span> !isEmpty <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> random = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">0</span> ..&lt; <span class="built_in">count</span>, using: &amp;generator)</span><br><span class="line">    <span class="keyword">let</span> idx = index(startIndex, offsetBy: random)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>[idx]</span><br><span class="line">  &#125;</span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">randomElement</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">var</span> g = <span class="type">SystemRandomNumberGenerator</span>()</span><br><span class="line">    <span class="keyword">return</span> randomElement(using: &amp;g)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// The system's default source of random data.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// When you generate random values, shuffle a collection, or perform another</span></span><br><span class="line"><span class="comment">/// operation that depends on random data, this type is the generator used by</span></span><br><span class="line"><span class="comment">/// default. For example, the two method calls in this example are equivalent:</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let x = Int.random(in: 1...100)</span></span><br><span class="line"><span class="comment">///     var g = SystemRandomNumberGenerator()</span></span><br><span class="line"><span class="comment">///     let y = Int.random(in: 1...100, using: &amp;g)</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// `SystemRandomNumberGenerator` is automatically seeded, is safe to use in</span></span><br><span class="line"><span class="comment">/// multiple threads, and uses a cryptographically secure algorithm whenever</span></span><br><span class="line"><span class="comment">/// possible.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Platform Implementation of `SystemRandomNumberGenerator`</span></span><br><span class="line"><span class="comment">/// ========================================================</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// While the system generator is automatically seeded and thread-safe on every</span></span><br><span class="line"><span class="comment">/// platform, the cryptographic quality of the stream of random data produced by</span></span><br><span class="line"><span class="comment">/// the generator may vary. For more detail, see the documentation for the APIs</span></span><br><span class="line"><span class="comment">/// used by each platform.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Apple platforms use `arc4random_buf(3)`.</span></span><br><span class="line"><span class="comment">/// - Linux platforms use `getrandom(2)` when available; otherwise, they read</span></span><br><span class="line"><span class="comment">///   from `/dev/urandom`.</span></span><br><span class="line"><span class="comment">/// - Windows uses `BCryptGenRandom`</span></span><br><span class="line">  @frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">SystemRandomNumberGenerator</span>: <span class="title">RandomNumberGenerator</span>, <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Creates a new instance of the system's default random number generator.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns a value from a uniform, independent distribution of binary data.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: An unsigned 64-bit random value.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">UInt64</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> random: <span class="type">UInt64</span> = <span class="number">0</span></span><br><span class="line">    swift_stdlib_random(&amp;random, <span class="type">MemoryLayout</span>&lt;<span class="type">UInt64</span>&gt;.size)</span><br><span class="line">    <span class="keyword">return</span> random</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="popFirst">popFirst</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Removes and returns the first element of the collection.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Returns: The first element of the collection if the collection is</span></span><br><span class="line"><span class="comment">///   not empty; otherwise, `nil`.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Complexity: O(1)</span></span><br><span class="line">@inlinable</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">popFirst</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> swift-3-indexing-model - review the following</span></span><br><span class="line">  <span class="keyword">guard</span> !isEmpty <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">  <span class="comment">/// 一定有倔种来告诉我，我们在swift不推荐使用“!”</span></span><br><span class="line">  <span class="keyword">let</span> element = first!</span><br><span class="line">  <span class="comment">/// 你删除first这么带劲吗？</span></span><br><span class="line">  <span class="keyword">self</span> = <span class="keyword">self</span>[index(after: startIndex)..&lt;endIndex]</span><br><span class="line">  <span class="keyword">return</span> element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="isEmpty">isEmpty</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// isEmpty 有什么值得写的？请认真看看下面的注视</span></span><br><span class="line"><span class="comment">/// A Boolean value indicating whether the collection is empty.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// When you need to check whether your collection is empty, use the</span></span><br><span class="line"><span class="comment">/// `isEmpty` property instead of checking that the `count` property is</span></span><br><span class="line"><span class="comment">/// equal to zero. For collections that don't conform to</span></span><br><span class="line"><span class="comment">/// `RandomAccessCollection`, accessing the `count` property iterates</span></span><br><span class="line"><span class="comment">/// through the elements of the collection.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let horseName = "Silver"</span></span><br><span class="line"><span class="comment">///     if horseName.isEmpty &#123;</span></span><br><span class="line"><span class="comment">///         print("My horse has no name.")</span></span><br><span class="line"><span class="comment">///     &#125; else &#123;</span></span><br><span class="line"><span class="comment">///         print("Hi ho, \(horseName)!")</span></span><br><span class="line"><span class="comment">///     &#125;</span></span><br><span class="line"><span class="comment">///     // Prints "Hi ho, Silver!")</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Complexity: O(1)</span></span><br><span class="line">@inlinable</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> startIndex == endIndex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/05/11/Swift-Source-Code-Collection/" data-id="cl3sosys7001vt0z6xm5grzrb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift-source-code/">swift source code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Swift-Source-Code-Sequence" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/04/Swift-Source-Code-Sequence/" class="article-date">
  <time datetime="2022-05-04T03:23:21.000Z" itemprop="datePublished">2022-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/04/Swift-Source-Code-Sequence/">Swift Source Code: Sequence</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Summary">Summary</h1><p>Sequence provides iteration. It allows you to create an iterator, but there are no guarantees about whether the sequence is single-pass (e.g. reading from standard input) or multi-pass (iterating over an array).</p>
<h1 id="Types">Types</h1><h2 id="IteratorProtocol">IteratorProtocol</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// The type of element traversed by the iterator.</span></span><br><span class="line">  associatedtype <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Advances to the next element and returns it, or `nil` if no next element</span></span><br><span class="line">  <span class="comment">/// exists.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Repeatedly calling this method returns, in order, all the elements of the</span></span><br><span class="line">  <span class="comment">/// underlying sequence. As soon as the sequence has run out of elements, all</span></span><br><span class="line">  <span class="comment">/// subsequent calls return `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// You must not call this method if any other copy of this iterator has been</span></span><br><span class="line">  <span class="comment">/// advanced with a call to its `next()` method.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The following example shows how an iterator can be used explicitly to</span></span><br><span class="line">  <span class="comment">/// emulate a `for`-`in` loop. First, retrieve a sequence's iterator, and</span></span><br><span class="line">  <span class="comment">/// then call the iterator's `next()` method until it returns `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let numbers = [2, 3, 5, 7]</span></span><br><span class="line">  <span class="comment">///     var numbersIterator = numbers.makeIterator()</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     while let num = numbersIterator.next() &#123;</span></span><br><span class="line">  <span class="comment">///         print(num)</span></span><br><span class="line">  <span class="comment">///     &#125;</span></span><br><span class="line">  <span class="comment">///     // Prints "2"</span></span><br><span class="line">  <span class="comment">///     // Prints "3"</span></span><br><span class="line">  <span class="comment">///     // Prints "5"</span></span><br><span class="line">  <span class="comment">///     // Prints "7"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: The next element in the underlying sequence, if a next element</span></span><br><span class="line">  <span class="comment">///   exists; otherwise, `nil`.</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="func"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">Element</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Sequence">Sequence</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// A type representing the sequence's elements.</span></span><br><span class="line">  associatedtype <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that provides the sequence's iteration interface and</span></span><br><span class="line">  <span class="comment">/// encapsulates its iteration state.</span></span><br><span class="line">  associatedtype <span class="type">Iterator</span>: <span class="type">IteratorProtocol</span> <span class="keyword">where</span> <span class="type">Iterator</span>.<span class="type">Element</span> == <span class="type">Element</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> &lt;rdar://problem/34142121&gt;</span></span><br><span class="line">  <span class="comment">// This typealias should be removed as it predates the source compatibility</span></span><br><span class="line">  <span class="comment">// guarantees of Swift 3, but it cannot due to a bug.</span></span><br><span class="line">  <span class="preprocessor">@available</span>(*, unavailable, renamed: <span class="string">"Iterator"</span>)</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">Iterator</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A type that represents a subsequence of some of the sequence's elements.</span></span><br><span class="line">  <span class="comment">// associatedtype SubSequence: Sequence = AnySequence&lt;Element&gt;</span></span><br><span class="line">  <span class="comment">//   where Element == SubSequence.Element,</span></span><br><span class="line">  <span class="comment">//         SubSequence.SubSequence == SubSequence</span></span><br><span class="line">  <span class="comment">// typealias SubSequence = AnySequence&lt;Element&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Returns an iterator over the elements of this sequence.</span></span><br><span class="line">  __consuming <span class="func"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// A value less than or equal to the number of elements in the sequence,</span></span><br><span class="line">  <span class="comment">/// calculated nondestructively.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The default implementation returns 0. If you provide your own</span></span><br><span class="line">  <span class="comment">/// implementation, make sure to compute the value nondestructively.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(1), except if the sequence also conforms to `Collection`.</span></span><br><span class="line">  <span class="comment">///   In this case, see the documentation of `Collection.underestimatedCount`.</span></span><br><span class="line">  <span class="keyword">var</span> underestimatedCount: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">_customContainsEquatableElement</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> element: Element</span><br><span class="line">  )</span></span> -&gt; <span class="type">Bool</span>?</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Create a native array buffer containing the elements of `self`,</span></span><br><span class="line">  <span class="comment">/// in the same order.</span></span><br><span class="line">  __consuming <span class="func"><span class="keyword">func</span> <span class="title">_copyToContiguousArray</span><span class="params">()</span></span> -&gt; <span class="type">ContiguousArray</span>&lt;<span class="type">Element</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Copy `self` into an unsafe buffer, initializing its memory.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The default implementation simply iterates over the elements of the</span></span><br><span class="line">  <span class="comment">/// sequence, initializing the buffer one item at a time.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// For sequences whose elements are stored in contiguous chunks of memory,</span></span><br><span class="line">  <span class="comment">/// it may be more efficient to copy them in bulk, using the</span></span><br><span class="line">  <span class="comment">/// `UnsafeMutablePointer.initialize(from:count:)` method.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter ptr: An unsafe buffer addressing uninitialized memory. The</span></span><br><span class="line">  <span class="comment">///    buffer must be of sufficient size to accommodate</span></span><br><span class="line">  <span class="comment">///    `source.underestimatedCount` elements. (Some implementations trap</span></span><br><span class="line">  <span class="comment">///    if given a buffer that's smaller than this.)</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Returns: `(it, c)`, where `c` is the number of elements copied into the</span></span><br><span class="line">  <span class="comment">///    buffer, and `it` is a partially consumed iterator that can be used to</span></span><br><span class="line">  <span class="comment">///    retrieve elements that did not fit into the buffer (if any). (This can</span></span><br><span class="line">  <span class="comment">///    only happen if `underestimatedCount` turned out to be an actual</span></span><br><span class="line">  <span class="comment">///    underestimate, and the buffer did not contain enough space to hold the</span></span><br><span class="line">  <span class="comment">///    entire sequence.)</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///    On return, the memory region in `buffer[0 ..&lt; c]` is initialized to</span></span><br><span class="line">  <span class="comment">///    the first `c` elements in the sequence.</span></span><br><span class="line">  __consuming <span class="func"><span class="keyword">func</span> <span class="title">_copyContents</span><span class="params">(</span><br><span class="line">    initializing ptr: UnsafeMutableBufferPointer&lt;Element&gt;</span><br><span class="line">  )</span></span> -&gt; (<span class="type">Iterator</span>,<span class="type">UnsafeMutableBufferPointer</span>&lt;<span class="type">Element</span>&gt;.<span class="type">Index</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// Executes a closure on the sequence’s contiguous storage.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// This method calls `body(buffer)`, where `buffer` is a pointer to the</span></span><br><span class="line">  <span class="comment">/// collection’s contiguous storage. If the contiguous storage doesn't exist,</span></span><br><span class="line">  <span class="comment">/// the collection creates it. If the collection doesn’t support an internal</span></span><br><span class="line">  <span class="comment">/// representation in a form of contiguous storage, the method doesn’t call</span></span><br><span class="line">  <span class="comment">/// `body` --- it immediately returns `nil`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The optimizer can often eliminate bounds- and uniqueness-checking</span></span><br><span class="line">  <span class="comment">/// within an algorithm. When that fails, however, invoking the same</span></span><br><span class="line">  <span class="comment">/// algorithm on the `buffer` argument may let you trade safety for speed.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Successive calls to this method may provide a different pointer on each</span></span><br><span class="line">  <span class="comment">/// call. Don't store `buffer` outside of this method.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// A `Collection` that provides its own implementation of this method</span></span><br><span class="line">  <span class="comment">/// must provide contiguous storage to its elements in the same order</span></span><br><span class="line">  <span class="comment">/// as they appear in the collection. This guarantees that it's possible to</span></span><br><span class="line">  <span class="comment">/// generate contiguous mutable storage to any of its subsequences by slicing</span></span><br><span class="line">  <span class="comment">/// `buffer` with a range formed from the distances to the subsequence's</span></span><br><span class="line">  <span class="comment">/// `startIndex` and `endIndex`, respectively.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - body: A closure that receives an `UnsafeBufferPointer` to the</span></span><br><span class="line">  <span class="comment">///     sequence's contiguous storage.</span></span><br><span class="line">  <span class="comment">/// - Returns: The value returned from `body`, unless the sequence doesn't</span></span><br><span class="line">  <span class="comment">///   support contiguous storage, in which case the method ignores `body` and</span></span><br><span class="line">  <span class="comment">///   returns `nil`.</span></span><br><span class="line">  <span class="func"><span class="keyword">func</span> <span class="title">withContiguousStorageIfAvailable</span><span class="generics">&lt;R&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> body: <span class="params">(<span class="number">_</span> buffer: UnsafeBufferPointer&lt;Element&gt;)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">R</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; <span class="type">R</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DropFirstSequence,_PrefixSequence,_DropWhileSequence">DropFirstSequence, PrefixSequence, DropWhileSequence</h2><p>在dropFirst，prefix， drop(while:) 方法中，返回的并非为Array或者Sequence类型，而是返回了对应的XXSequence struct 类型。看注释上说时可以lazily consume. 这几类Sequence有些类似Box/Wrapper Sequence.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A sequence that lazily consumes and drops `n` elements from an underlying</span></span><br><span class="line"><span class="comment">/// `Base` iterator before possibly returning the first available element.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The underlying iterator's sequence may be infinite.</span></span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">DropFirstSequence</span>&lt;<span class="title">Base</span>: <span class="title">Sequence</span>&gt; </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> _base: <span class="type">Base</span></span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> _limit: <span class="type">Int</span></span><br><span class="line">  </span><br><span class="line">  @inlinable </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">Base</span>, dropping limit: <span class="type">Int</span>) &#123;</span><br><span class="line">    _precondition(limit &gt;= <span class="number">0</span>, </span><br><span class="line">      <span class="string">"Can't drop a negative number of elements from a sequence"</span>)</span><br><span class="line">    _base = base</span><br><span class="line">    _limit = limit</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DropFirstSequence</span>: <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Element</span> = <span class="type">Base</span>.<span class="type">Element</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Iterator</span> = <span class="type">Base</span>.<span class="type">Iterator</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">SubSequence</span> = <span class="type">AnySequence</span>&lt;<span class="type">Element</span>&gt;</span><br><span class="line">  </span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> it = _base.makeIterator()</span><br><span class="line">    <span class="keyword">var</span> dropped = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> dropped &lt; _limit, it.next() != <span class="literal">nil</span> &#123; dropped &amp;+= <span class="number">1</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> it</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">dropFirst</span><span class="params">(<span class="number">_</span> k: Int)</span></span> -&gt; <span class="type">DropFirstSequence</span>&lt;<span class="type">Base</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// If this is already a _DropFirstSequence, we need to fold in</span></span><br><span class="line">    <span class="comment">// the current drop count and drop limit so no data is lost.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// i.e. [1,2,3,4].dropFirst(1).dropFirst(1) should be equivalent to</span></span><br><span class="line">    <span class="comment">// [1,2,3,4].dropFirst(2).</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">DropFirstSequence</span>(_base, dropping: _limit + k)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A sequence that only consumes up to `n` elements from an underlying</span></span><br><span class="line"><span class="comment">/// `Base` iterator.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The underlying iterator's sequence may be infinite.</span></span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">PrefixSequence</span>&lt;<span class="title">Base</span>: <span class="title">Sequence</span>&gt; </span>&#123;</span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _base: <span class="type">Base</span></span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> _maxLength: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">Base</span>, maxLength: <span class="type">Int</span>) &#123;</span><br><span class="line">    _precondition(maxLength &gt;= <span class="number">0</span>, <span class="string">"Can't take a prefix of negative length"</span>)</span><br><span class="line">    _base = base</span><br><span class="line">    _maxLength = maxLength</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A sequence that lazily consumes and drops `n` elements from an underlying</span></span><br><span class="line"><span class="comment">/// `Base` iterator before possibly returning the first available element.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The underlying iterator's sequence may be infinite.</span></span><br><span class="line">@frozen</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">DropWhileSequence</span>&lt;<span class="title">Base</span>: <span class="title">Sequence</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Element</span> = <span class="type">Base</span>.<span class="type">Element</span></span><br><span class="line">  </span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _iterator: <span class="type">Base</span>.<span class="type">Iterator</span></span><br><span class="line">  @usableFromInline</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> _nextElement: <span class="type">Element</span>?</span><br><span class="line">  </span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(iterator: <span class="type">Base</span>.<span class="type">Iterator</span>, predicate: (<span class="type">Element</span>) <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line">    _iterator = iterator</span><br><span class="line">    _nextElement = _iterator.next()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> x = _nextElement, <span class="keyword">try</span> predicate(x) &#123;</span><br><span class="line">      _nextElement = _iterator.next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">Base</span>, predicate: (<span class="type">Element</span>) <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>) <span class="keyword">rethrows</span> &#123;</span><br><span class="line">    <span class="keyword">self</span> = <span class="keyword">try</span> <span class="type">DropWhileSequence</span>(iterator: base.makeIterator(), predicate: predicate)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Functions">Functions</h1><h2 id="suffix(__maxLength:_Int)">suffix(_ maxLength: Int)</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Returns a subsequence, up to the given maximum length, containing the</span></span><br><span class="line"><span class="comment">/// final elements of the sequence.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The sequence must be finite. If the maximum length exceeds the number of</span></span><br><span class="line"><span class="comment">/// elements in the sequence, the result contains all the elements in the</span></span><br><span class="line"><span class="comment">/// sequence.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let numbers = [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">///     print(numbers.suffix(2))</span></span><br><span class="line"><span class="comment">///     // Prints "[4, 5]"</span></span><br><span class="line"><span class="comment">///     print(numbers.suffix(10))</span></span><br><span class="line"><span class="comment">///     // Prints "[1, 2, 3, 4, 5]"</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter maxLength: The maximum number of elements to return. The</span></span><br><span class="line"><span class="comment">///   value of `maxLength` must be greater than or equal to zero.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Complexity: O(*n*), where *n* is the length of the sequence.</span></span><br><span class="line">@inlinable</span><br><span class="line"><span class="keyword">public</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">suffix</span><span class="params">(<span class="number">_</span> maxLength: Int)</span></span> -&gt; [<span class="type">Element</span>] &#123;</span><br><span class="line">  _Precondition(maxLength &gt;= <span class="number">0</span>, <span class="string">"Can't take a suffix of negative length from a sequence"</span>)</span><br><span class="line">  <span class="keyword">guard</span> maxLength != <span class="number">0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> &lt;rdar://problem/21885650&gt; Create reusable RingBuffer&lt;T&gt;</span></span><br><span class="line">  <span class="comment">// Put incoming elements into a ring buffer to save space. Once all</span></span><br><span class="line">  <span class="comment">// elements are consumed, reorder the ring buffer into a copy and return it.</span></span><br><span class="line">  <span class="comment">// This saves memory for sequences particularly longer than `maxLength`.</span></span><br><span class="line">  <span class="comment">// 这里提到[RingBuffer](https://en.wikipedia.org/wiki/Circular_buffer)这个数据结构用于节省空间，这块还是值得注意的。因为如果使用正常的Array或者ContiguousArray，会创建一个和self本身同等大小的array，而使用RingBuffer则只会使用maxLength大小的空间.</span></span><br><span class="line">  <span class="comment">// 已经有相关RingBuffer(CircularBuffer)实现的[PR](https://github.com/apple/swift/pull/30242/files)，最终没有merge到main</span></span><br><span class="line">  <span class="keyword">var</span> ringBuffer = <span class="type">ContiguousArray</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">  ringBuffer.reserveCapacity(<span class="type">Swift</span>.<span class="built_in">min</span>(maxLength, underestimatedCount))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ringBuffer.<span class="built_in">count</span> &lt; maxLength &#123;</span><br><span class="line">      ringBuffer.append(element)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// RingBuffer相关操作，只保留buffer大小的数据，其他数据进行覆盖</span></span><br><span class="line">      ringBuffer[i] = element</span><br><span class="line">      i = (i + <span class="number">1</span>) % maxLength</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> i != ringBuffer.startIndex &#123;</span><br><span class="line">    <span class="comment">// Rotate RingBuffer</span></span><br><span class="line">    <span class="keyword">var</span> rotated = <span class="type">ContiguousArray</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">    rotated.reserveCapacity(ringBuffer.<span class="built_in">count</span>)</span><br><span class="line">    rotated += ringBuffer[i..&lt;ringBuffer.endIndex]</span><br><span class="line">    rotated += ringBuffer[<span class="number">0</span>..&lt;i]</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Array</span>(rotated)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Array</span>(ringBuffer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dropLast(__k:_Int_=_1)_-&gt;_[Element]">dropLast(_ k: Int = 1) -&gt; [Element]</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Returns a sequence containing all but the given number of final</span></span><br><span class="line"><span class="comment">/// elements.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The sequence must be finite. If the number of elements to drop exceeds</span></span><br><span class="line"><span class="comment">/// the number of elements in the sequence, the result is an empty</span></span><br><span class="line"><span class="comment">/// sequence.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     let numbers = [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">///     print(numbers.dropLast(2))</span></span><br><span class="line"><span class="comment">///     // Prints "[1, 2, 3]"</span></span><br><span class="line"><span class="comment">///     print(numbers.dropLast(10))</span></span><br><span class="line"><span class="comment">///     // Prints "[]"</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Parameter n: The number of elements to drop off the end of the</span></span><br><span class="line"><span class="comment">///   sequence. `n` must be greater than or equal to zero.</span></span><br><span class="line"><span class="comment">/// - Returns: A sequence leaving off the specified number of elements.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - Complexity: O(*n*), where *n* is the length of the sequence.</span></span><br><span class="line">@inlinable</span><br><span class="line"><span class="keyword">public</span> __consuming <span class="func"><span class="keyword">func</span> <span class="title">dropLast</span><span class="params">(<span class="number">_</span> k: Int = <span class="number">1</span>)</span></span> -&gt; [<span class="type">Element</span>] &#123;</span><br><span class="line">  _precondition(k &gt;= <span class="number">0</span>, <span class="string">"Can't drop a negative number of elements from a sequence"</span>)</span><br><span class="line">  <span class="keyword">guard</span> k != <span class="number">0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="type">Array</span>(<span class="keyword">self</span>) &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> &lt;rdar://problem/21885650&gt; Create reusable RingBuffer&lt;T&gt;</span></span><br><span class="line">  <span class="comment">// Put incoming elements from this sequence in a holding tank, a ring buffer</span></span><br><span class="line">  <span class="comment">// of size &lt;= k. If more elements keep coming in, pull them out of the</span></span><br><span class="line">  <span class="comment">// holding tank into the result, an `Array`. This saves</span></span><br><span class="line">  <span class="comment">// `k` * sizeof(Element) of memory, because slices keep the entire</span></span><br><span class="line">  <span class="comment">// memory of an `Array` alive.</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="type">ContiguousArray</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">  <span class="comment">// ringBuffer的大小同k相同，最后会保存被drop的元素</span></span><br><span class="line">  <span class="keyword">var</span> ringBuffer = <span class="type">ContiguousArray</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">  <span class="keyword">var</span> i = ringBuffer.startIndex</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="comment">// 当ringbuffer小于k时，将元素放入ringbuffer中(holding tank)</span></span><br><span class="line">    <span class="keyword">if</span> ringBuffer.<span class="built_in">count</span> &lt; k &#123;</span><br><span class="line">      ringBuffer.append(element)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// pull them out of the holding tank into the result</span></span><br><span class="line">      result.append(ringBuffer[i])</span><br><span class="line">      <span class="comment">// 更新ringbuffer与index</span></span><br><span class="line">      ringBuffer[i] = element</span><br><span class="line">      i = (i + <span class="number">1</span>) % k</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">Array</span>(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="elementsEqual">elementsEqual</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// 直接比较两个两个类型的Sequence元素是否相同，可以省去转换成相同type的步骤</span></span><br><span class="line">  <span class="comment">/// Returns a Boolean value indicating whether this sequence and another</span></span><br><span class="line">  <span class="comment">/// sequence contain the same elements in the same order.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// At least one of the sequences must be finite.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// This example tests whether one countable range shares the same elements</span></span><br><span class="line">  <span class="comment">/// as another countable range and an array.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let a = 1...3</span></span><br><span class="line">  <span class="comment">///     let b = 1...10</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     print(a.elementsEqual(b))</span></span><br><span class="line">  <span class="comment">///     // Prints "false"</span></span><br><span class="line">  <span class="comment">///     print(a.elementsEqual([1, 2, 3]))</span></span><br><span class="line">  <span class="comment">///     // Prints "true"</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter other: A sequence to compare to this sequence.</span></span><br><span class="line">  <span class="comment">/// - Returns: `true` if this sequence and `other` contain the same elements</span></span><br><span class="line">  <span class="comment">///   in the same order.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(*m*), where *m* is the lesser of the length of the</span></span><br><span class="line">  <span class="comment">///   sequence and the length of `other`.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">elementsEqual</span><span class="generics">&lt;OtherSequence: Sequence&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> other: OtherSequence</span><br><span class="line">  )</span></span> -&gt; <span class="type">Bool</span> <span class="keyword">where</span> <span class="type">OtherSequence</span>.<span class="type">Element</span> == <span class="type">Element</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.elementsEqual(other, by: ==)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="flatMap">flatMap</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Returns an array containing the concatenated results of calling the</span></span><br><span class="line">  <span class="comment">/// given transformation with each element of this sequence.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Use this method to receive a single-level collection when your</span></span><br><span class="line">  <span class="comment">/// transformation produces a sequence or collection for each element.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// In this example, note the difference in the result of using `map` and</span></span><br><span class="line">  <span class="comment">/// `flatMap` with a transformation that returns an array.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let numbers = [1, 2, 3, 4]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let mapped = numbers.map &#123; Array(repeating: $0, count: $0) &#125;</span></span><br><span class="line">  <span class="comment">///     // [[1], [2, 2], [3, 3, 3], [4, 4, 4, 4]]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let flatMapped = numbers.flatMap &#123; Array(repeating: $0, count: $0) &#125;</span></span><br><span class="line">  <span class="comment">///     // [1, 2, 2, 3, 3, 3, 4, 4, 4, 4]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// In fact, `s.flatMap(transform)`  is equivalent to</span></span><br><span class="line">  <span class="comment">/// `Array(s.map(transform).joined())`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter transform: A closure that accepts an element of this</span></span><br><span class="line">  <span class="comment">///   sequence as its argument and returns a sequence or collection.</span></span><br><span class="line">  <span class="comment">/// - Returns: The resulting flattened array.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(*m* + *n*), where *n* is the length of this sequence</span></span><br><span class="line">  <span class="comment">///   and *m* is the length of the result.</span></span><br><span class="line">  @inlinable</span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">flatMap</span><span class="generics">&lt;SegmentOfResult: Sequence&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">SegmentOfResult</span></span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">SegmentOfResult</span>.<span class="type">Element</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">SegmentOfResult</span>.<span class="type">Element</span>] = []</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      <span class="comment">/// 有别于map的地方</span></span><br><span class="line">      result.append(contentsOf: <span class="keyword">try</span> transform(element))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="compactMap">compactMap</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Returns an array containing the non-`nil` results of calling the given</span></span><br><span class="line">  <span class="comment">/// transformation with each element of this sequence.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Use this method to receive an array of non-optional values when your</span></span><br><span class="line">  <span class="comment">/// transformation produces an optional value.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// In this example, note the difference in the result of using `map` and</span></span><br><span class="line">  <span class="comment">/// `compactMap` with a transformation that returns an optional `Int` value.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let possibleNumbers = ["1", "2", "three", "///4///", "5"]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let mapped: [Int?] = possibleNumbers.map &#123; str in Int(str) &#125;</span></span><br><span class="line">  <span class="comment">///     // [1, 2, nil, nil, 5]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///     let compactMapped: [Int] = possibleNumbers.compactMap &#123; str in Int(str) &#125;</span></span><br><span class="line">  <span class="comment">///     // [1, 2, 5]</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameter transform: A closure that accepts an element of this</span></span><br><span class="line">  <span class="comment">///   sequence as its argument and returns an optional value.</span></span><br><span class="line">  <span class="comment">/// - Returns: An array of the non-`nil` results of calling `transform`</span></span><br><span class="line">  <span class="comment">///   with each element of the sequence.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Complexity: O(*m* + *n*), where *n* is the length of this sequence</span></span><br><span class="line">  <span class="comment">///   and *m* is the length of the result.</span></span><br><span class="line">  @inlinable <span class="comment">// protocol-only</span></span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">compactMap</span><span class="generics">&lt;ElementOfResult&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">ElementOfResult</span>?</span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">ElementOfResult</span>] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> _compactMap(transform)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The implementation of compactMap accepting a closure with an optional result.</span></span><br><span class="line">  <span class="comment">// Factored out into a separate function in order to be used in multiple</span></span><br><span class="line">  <span class="comment">// overloads.</span></span><br><span class="line">  @inlinable <span class="comment">// protocol-only</span></span><br><span class="line">  @inline(__always)</span><br><span class="line">  <span class="keyword">public</span> <span class="func"><span class="keyword">func</span> <span class="title">_compactMap</span><span class="generics">&lt;ElementOfResult&gt;</span><span class="params">(</span><br><span class="line">    <span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">ElementOfResult</span>?</span><br><span class="line">  ) <span class="keyword">rethrows</span> -&gt; [<span class="type">ElementOfResult</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">ElementOfResult</span>] = []</span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      <span class="comment">/// 与map的区别</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> newElement = <span class="keyword">try</span> transform(element) &#123;</span><br><span class="line">        result.append(newElement)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/05/04/Swift-Source-Code-Sequence/" data-id="cl3sosys5001qt0z65gosj40m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift-source-code/">swift source code</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Reading-Note-of-Book-Deep-Work" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/03/29/Reading-Note-of-Book-Deep-Work/" class="article-date">
  <time datetime="2021-03-29T12:11:26.000Z" itemprop="datePublished">2021-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/29/Reading-Note-of-Book-Deep-Work/">Reading Note of Book: Deep Work</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Chapter_One_-_Deep_work_is_valuable:">Chapter One - Deep work is valuable:</h2><h3 id="Two_Core_Abilities_for_Thriving_in_the_New_Economy">Two Core Abilities for Thriving in the New Economy</h3><ol>
<li>The ability to quickly master hard things.</li>
<li>The ability to produce at an elite level, in terms of both quality and speed.</li>
</ol>
<h3 id="Deep_Work_Helps_You_Quickly_Learn_Hard_Things">Deep Work Helps You Quickly Learn Hard Things</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Let your mind become a lens, thanks to the converging rays of attention;&#10;let your soul be all intent on whatever it is that is established in your mind as a dominant, wholly absorbing idea.&#10;-- Antonin-Dalmace Sertillanges</span><br></pre></td></tr></table></figure>
<h4 id="Deliberate_practice">Deliberate practice</h4><ul>
<li>your attention is focused tightly on a specific skill you’re trying to improve or an idea you’re trying to master;</li>
<li>you receive feedback so you can correct your approach to keep your attention exactly where it’s most productive.</li>
</ul>
<h3 id="Deep_Work_Helps_You_Produce_at_an_Elite_Level">Deep Work Helps You Produce at an Elite Level</h3><p><code>High-Quality Work Produced = (Time Spent) x (Intensity of Focus)</code></p>
<h2 id="Chapter_Two_-_Deep_work_is_rare:">Chapter Two - Deep work is rare:</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">To do real good physics work, you do need absolute solid lengths&#10;of time...it needs a lot of concentration...if you have a job&#10;administrating anything, you don&#39;t have the time. So, I have&#10;invented another myth for myself: that I&#39;m irresponsible.&#10;I&#39;m actively irresponsible. I tell everyone I don&#39;t do anything.&#10;If anyone asks me to be on a committee for admissions, &#34;no,&#34; I tell&#10;them:I&#39;m irresponsible. -- Feynman</span><br></pre></td></tr></table></figure>
<h3 id="Busyness_as_Proxy_for_Productivity">Busyness as Proxy for Productivity</h3><p>In the absence of clear indicators of what it means to be productive and<br>valuable in their jobs, many knowledge workers turn back toward an industrial<br>indicator of productivity: doing lots of stuff in a visible manner.</p>
<p>Deep work is at a servere disadvantage in a technopoly because it builds on values like<br>quality, craftsmanship, and mastery that are decidedly old-fashioned and nontechnological.<br>Even worse, to support deep work often requires the rejection of much of what is new and high-tech.<br>Deep work is exiled in favor of more distracting high-tech behaviors.</p>
<h2 id="Chapter_Three_-_Deep_Work_Is_Meaningful">Chapter Three - Deep Work Is Meaningful</h2><h3 id="A_Neurological_Argument_for_Depth">A Neurological Argument for Depth</h3><p>Your world is the outcome of what you pay attention to, so consider for a moment the type of mental world constructed when you dedicate significant time to deep endeavors. There’s gravity and snese of imprortance inherent in deep work.</p>
<p>The idle mind is the devil’s workshop. When you lose focus, your mind tends to fix on what could be wrong with your life instead of what’s right.</p>
<p>A workday driven by the shallow, from a neurological perspective, is likely to be a draining and upsetting day, even if most of the shallow things that capture your attention seem harmless or fun.</p>
<h3 id="A_Pssychological_Argument_for_Depth">A Pssychological Argument for Depth</h3><p>Ironically, jobs are actually easier to enjoy than free time, because like flow activities they have built-in goals, feedback rules, and challenges, all of which encourage one to become involved in one’s work, to concentrate and lose oneself in it. Free time, on the other hand, is unstructured, and requires much greater effort to be shaped into something that can be enjoyed.</p>
<h3 id="A_Philosophical_Argument_for_Depth">A Philosophical Argument for Depth</h3><p>Beautiful code is short and concise, so if you were to give that code to another programmer they would say, “oh, that’s well written code.” It’s much like as if you were writing a poem.</p>
<p>Within the overall structure of a project there is always room for individuality and craftsmanship…One hundred years from now, our engineering may seem as archaic as the techniques used by medieval cathedral builders seem to today’s civil engineers, while our craftsmanship will still be honored.</p>
<h2 id="Chapter_Four_-_Rule_1:_Work_Deeply">Chapter Four - Rule 1: Work Deeply</h2><p>You have a finite amount of willpower that becomes depleted as you use it.</p>
<p>The key to developing a deep work habit is to move beyond good intentions and add <strong>routines</strong> and <strong>rituals</strong> to your working life designed to minimize the amount of your limited willpower necessary to transition into and maintain a state of unbroken concentration.</p>
<p><strong>warning</strong>: You must be careful to choose a philosophy that fits your specific circumstances.</p>
<h3 id="The_monastic_Philosophy_of_Deep_Work_Scheduling">The monastic Philosophy of Deep Work Scheduling</h3><p>This philosophy attempts to maximize deep efforts by eliminating or radically minimizing shallow obligations.</p>
<h3 id="The_Bimodal_Philosophy_of_Deep_Work_Scheduling">The Bimodal Philosophy of Deep Work Scheduling</h3><p>This philosophy asks that you divide your time, dedicating some clearly defined staretches to deep pursuits and leaving the rest open to everything else.</p>
<h3 id="The_Rhythmic_Philosophy_of_Deep_Work_Scheduling">The Rhythmic Philosophy of Deep Work Scheduling</h3><p>This philosophy argues that the easiest way to consistently start deep work sessions is to transform them into a simple regular habit. The goal, in other words, is to generate a rhythm for this work that removes the need for you to invest energy in deciding if and when you’re going to go deep. The chain method is a good example of the rhythmic philosophy of deep work scheduling because it combines a simple scheduling euristic, with an easy way to remind yourself to do the work: the big red Xs on the calendar.</p>
<h3 id="The_Jourualistic_Philosophy_of_Deep_Work_Scheduling">The Jourualistic Philosophy of Deep Work Scheduling</h3><p>I call this approach, in which you fit deep work wherever you can into your schedule, the journalist philosophy.<br>This approach is not for the deep work novice. As I established in the opening to this rule, the ability to rapidly switch your mind from shallow to deep mode doesn’t come naturally. Without practice, such switches can seriously deplete your finite willpower reserves. This habit also requires a sense of confidence in your abilities.</p>
<h3 id="Deep_work_ritual">Deep work ritual</h3><ul>
<li><p>Where you’ll work and for how long. Your ritual needs to specify a location for your deep work efforts.</p>
</li>
<li><p>How you’ll work once you start to work. Your ritual needs rules and processes to keep your efforts structured.</p>
</li>
<li><p>How you’ll support you work. Your ritual needs to ensure your brain gets the support it needs to keep operating at a high level of depth.</p>
</li>
</ul>
<h3 id="Make_Grand_Gestures">Make Grand Gestures</h3><p>The concept is simple: By leveraging a radical change to your normal environment, coupled perhaps with a significant investment of effort or money, all dedicated toward supporting a deep work task, you increase the perceived importance of the task. This boost in importance reduces your mind’s instinct to procrastinate and delivers an injection of motivation and energy.</p>
<h3 id="The_4_disciplines_of_excution">The 4 disciplines of excution</h3><ul>
<li>Discipline 1: Focus on the wildly important</li>
</ul>
<p>“The more you try to do, the less you actually accomplish.” execution should be aimed at a small number of “wildly important goals.” This simplicity will help focus an organization’s energy to a sufficient intensity to ignite real results.</p>
<p>For an individual focused on deep work, the implication is that you should identify a small number of ambitious outcomes to pursue with your deep work hours.</p>
<ul>
<li>Discipline 2: Act on the lead measures</li>
</ul>
<p>once you’ve identified a wildly important goal, you need to measure your success.</p>
<p>For an individual focused on deep work, it’s easy to identify the relevant lead measure: time spent in a state of deep work dedicated toward your wildly important goal.</p>
<ul>
<li><p>Discipline 3: Keep a compilling scoreboard.</p>
</li>
<li><p>Discipline 4: Create a cadence of accountability.</p>
</li>
</ul>
<h4 id="Why_a_shutdown_will_be_proftable_to_your_ability_to_produce_valuable_output-">Why a shutdown will be proftable to your ability to produce valuable output.</h4><ul>
<li><p>Reason 1: Downtime aids insights.</p>
</li>
<li><p>Reason 2: Downtime helps recharge the energy needed to work deeply.</p>
</li>
<li><p>Reason 3: The work that evening downtime replaces is usually not that important.</p>
</li>
</ul>
<h2 id="Rule_2:_Embrace_boredom">Rule 2: Embrace boredom</h2><ul>
<li><p>Rule 1: taught you how to integrate deep work into your schedule and support it with routines and rituals designed to help you consistently reach the current limiit of your concentration ability.</p>
</li>
<li><p>Rule 2: will help you significantly improve this limit. The starategies that follow are motivated by the key idea that getting the most out of your deep work habit requires training, and as clarified previously, this training must address two goals:</p>
<ul>
<li>improving your ability to concentrate intensely and</li>
<li>overcoming your desire for distraction</li>
</ul>
</li>
</ul>
<ul>
<li>Don’t take breaks from distraction, instead take breaks from focus.<br>point 1: this strategy works even if your job requires lots of internet use and/or prompt e-mail replies.<br>point 2: regardless of how you schedule your internet blocks, you must keep the time outside those blocks absolutely free from internet use.<br>point 3: scheduling internet use at home as well as at work can further improve your concentration traning.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/03/29/Reading-Note-of-Book-Deep-Work/" data-id="cl3sosys90020t0z6f0gdo8ft" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书/">读书</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-又开始写博客了" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/31/又开始写博客了/" class="article-date">
  <time datetime="2021-01-31T09:26:04.000Z" itemprop="datePublished">2021-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/31/又开始写博客了/">又开始写博客了</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>自己的博客停更了好久了，最近觉得应该重新开始记录。不是为了给谁看，只为自己留下一些感触，记录一下生活，和学习的东西。</p>
<p>刚刚想写得很多，开始写后，又悄悄地给删掉了。。。</p>
<p>好久不写了，第一篇就不写太长了，算是个简单的开始吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/01/31/又开始写博客了/" data-id="cl3sosyqj0009t0z64dmw3qqt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/life/">life</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS应用文件路径简介-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/26/iOS应用文件路径简介-md/" class="article-date">
  <time datetime="2015-12-26T07:18:21.000Z" itemprop="datePublished">2015-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/26/iOS应用文件路径简介-md/">iOS应用文件路径简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="iOS_标准目录结构">iOS 标准目录结构</h3><p>出于安全考虑，iOS只有特定目录可以写入数据。 当一款应用安装在设备上后，系统会创建一些系统目录给应用使用，一款应用只有权限访问其自己的路径下的数据。</p>
<h2 id="AppName-app">AppName.app</h2><p>整个应用的bundle文件。此目录包含整个应用和其所使用到的所有资源。 <em>此路径不能写， 只可读</em>， 如果强行写入，会改变安装时在系统注册的该目录的签名，如果签名改变，系统会组织程序启动。</p>
<h2 id="Documents/">Documents/</h2><p>用于存储用户产生的内容。 此目录会被iTunes<em>默认备份</em></p>
<h2 id="Documents/Inbox">Documents/Inbox</h2><p>此目录用于保存用于其他应用打开的文件。 例如，Mail应用汇将和此应用有关的附件保存于这个路径。 Documents interaction Controllers 也会放文件于此目录。</p>
<p>自己应用可以读取和删除此目录文件，但是<em>不能创建新文件或者写入已经存在的文件</em>， 如果要对该目录文件进行修改，请将要修改的文件移除到其他目录。<br><em>此目录默认被iTunes备份</em></p>
<h2 id="Library/">Library/</h2><p>此目录用于保存非用户数据文件。 Library下的子目录可以用于保存那些不希望用户看到的数据文件。<em>不要用Library下的目录保存用户数据文件</em></p>
<p>Library目录下(除了Caches目录及其子目录)会被<em>iTunes默认备份</em></p>
<h2 id="tmp/">tmp/</h2><p>用于那些不需要在每次启动需要持久化的临时文件。手动删除那些此路径下不用的临时文件。当应用没有运行时，系统也许会删除此目录下的文件。</p>
<p><em>此目录默认不会被iTunes备份</em></p>
<h3 id="应用产生的文件应该放在哪">应用产生的文件应该放在哪</h3><p>为了避免iOS设备间同步和备份流程耗时太久，应该对文件归属目录的选择特别注意。</p>
<ul>
<li>将用户数据保存于 Documents/. 用户数据包括那些需要让暴露给用户的文件 — 用户可以创建，删除，编辑的文件。 例如，对于视频和音频应用，用户数据包括用户下载过的文件等。</li>
<li>将应用创建的文件保存于Library/Application support/路径下。此目录下，用于保存应用自身使用，不暴露给用户的数据文件。包括数据文件，配置文件，模板文件和版本特定的资源文件等。</li>
<li>谨记保存于Documents/ 和 Application support/ 目录下的文件是<em>默认备份的</em>。可以使用<code>[NSURL setResourceValue:forKey:error:]</code>使用<code>NSURLIsExcludeFromBackupKey</code> key. <em>任何可以被重新下载的文件，一定不要进行备份</em>。</li>
<li>将数据缓存数据保存于Library/Caches 目录下。 缓存数据是那些没用该数据，应用也可以正常运行的数据， 但如果有缓存数据，会提高应用的性能。 例如，数据库缓存文件，可以下载的内容等。 <em>注意：系统也许会删除Caches/下的文件，来释放磁盘空间</em></li>
</ul>
<p>参考: <a href="https://developer.apple.com/library/ios/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html" target="_blank" rel="external">File System programming guide</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/26/iOS应用文件路径简介-md/" data-id="cl3sosyr9000it0z6pgoos6rg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Protocol-Extensions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/02/Protocol-Extensions/" class="article-date">
  <time datetime="2015-10-02T08:30:37.000Z" itemprop="datePublished">2015-10-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/02/Protocol-Extensions/">Protocol Extensions</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>资源推荐：</p>
<ul>
<li><a href="https://developer.apple.com/videos/wwdc/2015/?id=408" target="_blank" rel="external">Protocol-Oriented Programming in Swift</a>: WWDC 2015 session</li>
<li><a href="https://www.mikeash.com/pyblog/friday-qa-2015-06-19-the-best-of-whats-new-in-swift.html" target="_blank" rel="external">The Best of What’s New in Swift</a></li>
<li><a href="http://matthewpalmer.net/blog/2015/08/30/protocol-oriented-programming-in-the-real-world/" target="_blank" rel="external">Protocol Oriented Programming in the Real World</a></li>
<li><a href="https://github.com/matthewpalmer/Locksmith" target="_blank" rel="external">Locksmith</a> : A powerful, protocol-oriented library for working with the keychain in Swift.</li>
<li><a href="https://github.com/FlexMonkey/Blurable" target="_blank" rel="external">Blurable</a> :  Apply a Gaussian Blur to any UIView with Swift Protocol Extensions.</li>
</ul>
<p>此文为 <a href="https://www.mikeash.com/pyblog/friday-qa-2015-06-19-the-best-of-whats-new-in-swift.html" target="_blank" rel="external">The Best of What’s New in Swift</a> 有关Protocol Extensions的翻译。</p>
<h3 id="Protocol_Extensions">Protocol Extensions</h3><p>在Swift 2.0 之前， Objective-C和Swift，在protocols中只能包含方法声明。 protocols只包含接口定义即一堆等待遵守类型去实现的方法。 在Swift 2中使用 protocol extensions, protocols可以既包含声明，也可以包含实现。</p>
<p>经常，会有很多功能性方法适用于一类对象。 如， 所有的集合类型都可以有将一个集合内对象经过映射（map），而创建一个映射后的集合对象。 在Swift 2之前， 有两种方式可以达到这种能力。</p>
<pre><code><span class="bullet">* </span>在protocol中声明方法并要求对应遵循接口的对象实现自己的方法
<span class="bullet">* </span>全局函数
</code></pre><p>Cocoa基本上采用的是第一种解决方案。 虽然这些方法可能太适合成为任何protocol的一部分， 但是Cocoa的集合对象都有一个enumerateObjectsUsingBlock:方法，每个集合类型有各自的实现。</p>
<p>Swift 2之前，采用的是第二种解决方案。 想 map 这种全局函数，操作于 CollectionType . 这种方式很好的共享了函数实现， 但是语法奇怪并且不能针对特定类型重写实现方法。</p>
<p>有了 protocol extensions , 我们可以有了更牛X的第三种方式。  map  可以实现在 CollectionType 的一个扩展（extension）中。 所有遵循 CollectionType  的类型，就自动获得了一个 map 实现。</p>
<p>一下为一个简单的 map 函数实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CollectionType</span> </span>&#123;</span><br><span class="line">        <span class="func"><span class="keyword">func</span> <span class="title">myMap</span><span class="generics">&lt;U&gt;</span><span class="params">(f: <span class="keyword">Self</span>.Generator.Element -&gt; U)</span></span> -&gt; [<span class="type">U</span>] &#123;</span><br><span class="line">            <span class="keyword">var</span> result: [<span class="type">U</span>] = []</span><br><span class="line">            <span class="keyword">for</span> elt <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">                result.append(f(elt))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].myMap(&#123; $<span class="number">0</span> * <span class="number">2</span> &#125;)</span><br><span class="line">    <span class="comment">// This produces [2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>
<p>之前只可以作为 Array 的扩展，然后只可以在 Array 中使用。 有了一个接口的扩展， 上面的实现也可以在 Set 和 ArraySlice 和其他遵循 CollectionType  接口的类型中获得。</p>
<p>另一个很有意思的Swift protocol extensions特性是可以对类型做出限制。 举个栗子， 如果你想实现一个 max 属性。 但是 max 并不适用于所有集合类型， 只有那些有序集合才使用这个属性。 没问题！ 只要给扩展加一个限制，要求其实现类型必须遵守 Comparable  协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CollectionType</span> <span class="title">where</span> <span class="title">Self</span>.<span class="title">Generator</span>.<span class="title">Element</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">max</span>: <span class="type">Self</span>.<span class="type">Generator</span>.<span class="type">Element</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> best = <span class="keyword">self</span>[<span class="keyword">self</span>.startIndex]</span><br><span class="line">            <span class="keyword">for</span> elt <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> elt &gt; best &#123;</span><br><span class="line">                    best = elt</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> best</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Set</span>([<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]).<span class="built_in">max</span></span><br><span class="line">    <span class="comment">// This produces 5</span></span><br><span class="line"></span><br><span class="line">    [<span class="type">NSObject</span>(), <span class="type">NSObject</span>()].<span class="built_in">max</span></span><br><span class="line">    <span class="comment">// This produces an error, as NSObject is not Comparable</span></span><br></pre></td></tr></table></figure>
<p>protocol extensions 有一个会令人迷惑的地方， 虽然很小但是很重要，决定了protocol extension中方法是否需要动态分发(dynamic dispatch)。</p>
<p>一个在protocol extension中声明的方法也许也会在protocol中声明， 或者只存在于extension中。 只存在extension中的方法，不会动态分发（dynamic dispatch）并且也不能被复写。只声明在protocol中的方法是动态分发（dynamic dispatch）的并且可以被复写。talk is cheap, show me the code:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">extension</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">"default implementation of A"</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">"default implementation of B"</span>)</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">S</span>: <span class="title">P</span> </span>&#123;</span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">"specialized implementation of A"</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">"specialized implementation of B"</span>)</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> p: <span class="type">P</span> = <span class="type">S</span>()</span><br><span class="line"> p.a()</span><br><span class="line"> p.b()</span><br></pre></td></tr></table></figure>
<p>上面的代码会打印出：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">specialized <span class="keyword">implementation</span> <span class="keyword">of</span> A和<span class="keyword">default</span> <span class="keyword">implementation</span> <span class="keyword">of</span> B.</span><br></pre></td></tr></table></figure></p>
<p>使用protocol extensions还可以让Swift的protocol方法成为“可选”方法，在Swift 2中，我们可以这样实现一个delegate中的可选方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">MyClassDelegate</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">shouldDoThingOne</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">shouldDoThingTwo</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">extension</span> <span class="title">MyClassDelegate</span> </span>&#123;</span><br><span class="line">        <span class="func"><span class="keyword">func</span> <span class="title">shouldDoThingOne</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="comment">// Thing one is harmless and should almost always be done</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="func"><span class="keyword">func</span> <span class="title">shouldDoThingTwo</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="comment">// Thing two is a menace and should not be done without careful consideration</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/02/Protocol-Extensions/" data-id="cl3sosysa0023t0z6vac0kdfz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/">Swift</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-7-9-新特性总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/13/iOS-7-9-新特性总结/" class="article-date">
  <time datetime="2015-09-13T08:29:53.000Z" itemprop="datePublished">2015-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/13/iOS-7-9-新特性总结/">iOS 7 - 9 新特性总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="iOS_7">iOS 7</h3><ol>
<li><p><a href="https://developer.apple.com/library/ios/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009542" target="_blank" rel="external">Text Kit</a></p>
<p> 文字排版相关</p>
</li>
</ol>
<ol>
<li>多任务<ul>
<li>设置<code>UIBackgroundModes</code>为<code>fetch</code>来进行定期后台下载。</li>
<li>设置<code>UIBackgroundModes</code>为<code>remote-notification</code>, 用远程推送的方式，来让应用在后台进行下载内容。</li>
</ul>
</li>
</ol>
<ol>
<li>NSURLSession 用来替代NSURLConnection，配合多任务后台下载使用。</li>
<li><p>AirDrop<br> 附近设备分享传输文件，不需要网络。</p>
</li>
<li><p>新Framework:</p>
<ul>
<li>GameController.framework - 与游戏硬件通信</li>
<li>SpriteKit.framework - 游戏图形渲染和动画</li>
<li>Multipeer connectivity framework - 点对点网络</li>
<li>JavaScriptCore.framework - JavaScript对象的oc封装</li>
<li>MediaAccessibility.framework</li>
<li>SafariServices.framework - 用程序添加URL到用户Safari的阅读列表等</li>
</ul>
</li>
</ol>
<h3 id="iOS_8">iOS 8</h3><ol>
<li><p>Swift 1.0</p>
</li>
<li><p><a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ExtensibilityPG/index.html#//apple_ref/doc/uid/TP40014214" target="_blank" rel="external">App Extension</a></p>
<ul>
<li>Share， 在系统提供的分享选项中添加自己</li>
<li>Action, 对于选中内容可以执行一个action</li>
<li>Today， 通知中心的widget</li>
<li>Photo editinig.</li>
<li>Storage provider. 与其他应用共享文件存储位置</li>
<li>自定义键盘</li>
</ul>
</li>
<li><p><a href="https://developer.apple.com/library/ios/samplecode/KeychainTouchID/Introduction/Intro.html#//apple_ref/doc/uid/TP40014530" target="_blank" rel="external">Touch ID</a></p>
</li>
<li><p>Photos Framework</p>
</li>
<li>AV Audio Engine: Core Audio 更上层的封装。</li>
<li>HealthKit Framework</li>
<li>HomeKit Framework</li>
<li><a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/Handoff/HandoffFundamentals/HandoffFundamentals.html#//apple_ref/doc/uid/TP40014338" target="_blank" rel="external">Handoff</a></li>
<li>Size class</li>
<li>Metal - 替代OpenGL ES</li>
</ol>
<h3 id="iOS_9">iOS 9</h3><ol>
<li>Swift 2.0: 错误处理，Availability, Protocol extensions等</li>
<li>iPad 多任务</li>
<li>watchOS2</li>
<li>UI Test</li>
<li>App Thinning</li>
<li>Search API可以搜索App内容</li>
<li>新系统字体San francisco</li>
<li>Safari View Controller</li>
<li>Contacts Framework</li>
<li>3D Touch</li>
<li>Live Photo</li>
</ol>
<p>参考资料：<br>1.<a href="https://developer.apple.com/library/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS7.html" target="_blank" rel="external">https://developer.apple.com/library/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS7.html</a></p>
<p>2.<a href="https://developer.apple.com/library/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS8.html#//apple_ref/doc/uid/TP40014205-SW1" target="_blank" rel="external">https://developer.apple.com/library/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS8.html#//apple_ref/doc/uid/TP40014205-SW1</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/09/13/iOS-7-9-新特性总结/" data-id="cl3sosys0001dt0z64ll0hffy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SQLite-WAL-调研总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/08/SQLite-WAL-调研总结/" class="article-date">
  <time datetime="2015-08-08T08:28:53.000Z" itemprop="datePublished">2015-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/08/SQLite-WAL-调研总结/">SQLite WAL 调研总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>iOS 系统从iOS 7版本自带的SQLite数据库<strong>默认</strong>为开启WAL模式，即<code>journal_mode=WAL</code></li>
<li>iOS 版本4.3 以上系统自带SQLite版本为3.7.0以上（SQLite 3.7.0开始支持WAL）</li>
<li>在创建数据库连接时，执行<br><code>[conn executeUpdate:[NSString stringWithFormat:@”PRAGMA journal_mode=WAL”]];<br></code>即可</li>
<li>使用注意，在开启数据库时，不能只读打开。</li>
<li>低版本的SQLite不能读取高版本的SQLite生成的WAL文件，但是数据库文件是通用的。这种情况在用户进行iOS降级时可能会出现，可以把模式改成delete，再改回WAL来修复。</li>
<li>iOS 版本的SQLite是线程安全的（db 连接不要多线程共享）。<a href="http://www.sqlite.org/cvstrac/wiki?p=MultiThreading" target="_blank" rel="external">详情</a></li>
</ul>
<h3 id="WAL_工作原理：">WAL 工作原理：</h3><p>开启WAL模式后， 会有3个文件:</p>
<p>{<1>}<img src="/Users/mac/Downloads/wal.png" alt="database"></1></p>
<p>.db 为数据库文件</p><br><p>-shm 为每个数据库文件的共享内存文件</p><br><p>-wal 对数据库的修改操作于此文件</p>

<p>修改并不直接写入到数据库文件中，而是写入到另外一个称为WAL的文件中；如果事务失败，WAL中的记录会被忽略，撤销修改；如果事务成功，它将在随后的某个时间被写回到数据库文件中，提交修改。</p>
<p>同步WAL文件和数据库文件的行为被称为checkpoint（检查点），它由SQLite自动执行，默认是在WAL文件积累到1000页修改的时候；当然，在适当的时候，也可以手动执行checkpoint，SQLite提供了相关的接口。执行checkpoint之后，WAL文件会被清空。</p>
<p>在读的时候，SQLite将在WAL文件中搜索，找到最后一个写入点（end mark），记住它，并忽略在此之后的写入点（<strong>这保证了读写和读读可以并行执行</strong>）；随后，它确定所要读的数据所在页是否在WAL文件中，如果在，则读WAL文件中的数据，如果不在，则直接读数据库文件中的数据。为了避免每次读操作都遍历整个WAL文件去查找，SQLite使用了一种叫做wal-index的数据结构（保存于-shm）用于提高查找效率同时减少磁盘I/O。</p>
<p>在写的时候，SQLite将之写入到WAL文件尾即可，读写互不影响，所以渡河写可以同时执行。因为只有一个WAL文件，所以必须保证一次只执行一次写操作，<strong>因此写操作之间不能并行执行</strong>。</p>
<p>checkpoint的时候，将WAL中的数据同步回数据库中。checkpoint操作可以与读操作并行，但，如果有读操作正在读checkpoint要更新的数据库中的数据时，checkpoint操作会停止，直到读操作完成。</p>
<p>WAL在实现的过程中，使用了共享内存技术，因此，所有的读写进程必须在同一个机器上，否则，无法保证数据一致性。</p>
<h3 id="WAL相关使用配置:">WAL相关使用配置:</h3><p>启动： <code>PRAGMA journal_mode=WAL;</code></p>
<h4 id="自动checkpoint操作：">自动checkpoint操作：</h4><p>默认情况下，SQLite 自动触发checkpoint操作</p>
<ul>
<li>当一个COMMIT时，WAL文件的page数超过1000（可配置）</li>
<li>database连接关闭时。</li>
</ul>
<h4 id="手动触发checkpoint操作：详情">手动触发checkpoint操作：<a href="https://www.SQLite.org/pragma.html#pragma_wal_checkpoint" target="_blank" rel="external">详情</a></h4><ul>
<li>PRAGMA wal_autocheckpoint;</li>
<li>PRAGMA wal_autocheckpoint=N;</li>
<li>SQLite3_wal_checkpoint()</li>
</ul>
<p><a href="https://www.sqlite.org/wal.html" target="_blank" rel="external">参考资料</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/08/08/SQLite-WAL-调研总结/" data-id="cl3sosys8001xt0z6rqjpor93" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQLite/">SQLite</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLite/">SQLite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/">Unix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/combine/">combine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-archlinux/">linux, archlinux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phonegap/">phonegap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift-source-code/">swift source code</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编辑器配置文件/">编辑器配置文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 16.67px;">C</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/combine/" style="font-size: 10px;">combine</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/linux-archlinux/" style="font-size: 10px;">linux, archlinux</a> <a href="/tags/phonegap/" style="font-size: 10px;">phonegap</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/swift-source-code/" style="font-size: 13.33px;">swift source code</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/编辑器配置文件/" style="font-size: 10px;">编辑器配置文件</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">六月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/30/Combine-Introduction/">Combine: Introduction</a>
          </li>
        
          <li>
            <a href="/2022/05/13/Swift-Source-Code-ContiguousArray/">Swift Source Code: ContiguousArray</a>
          </li>
        
          <li>
            <a href="/2022/05/11/Swift-Source-Code-Collection/">Swift Source Code: Collection</a>
          </li>
        
          <li>
            <a href="/2022/05/04/Swift-Source-Code-Sequence/">Swift Source Code: Sequence</a>
          </li>
        
          <li>
            <a href="/2021/03/29/Reading-Note-of-Book-Deep-Work/">Reading Note of Book: Deep Work</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Anyuan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">home</a>
  
    <a href="/archives" class="mobile-nav-link">archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>